<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prototype 1: Copilot UX with Company Agent</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
            height: 100vh;
            overflow: hidden;
        }

        .app {
            display: flex;
            height: 100vh;
        }

        /* Left Sidebar */
        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(0, 0, 0, 0.08);
            box-shadow: 4px 0 12px rgba(0, 0, 0, 0.03);
        }

        .sidebar-header {
            padding: 16px;
            border-bottom: 1px solid #e0e0e0;
        }

        .new-chat-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px 16px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .new-chat-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .new-chat-btn:active {
            transform: translateY(0);
        }

        .sidebar-section {
            padding: 16px 12px;
        }

        .section-title {
            color: #666;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 12px;
            padding: 0 8px;
        }

        .agent-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            border-radius: 12px;
            cursor: pointer;
            color: #1a1a1a;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            margin-bottom: 6px;
        }

        .agent-item:hover {
            background: rgba(102, 126, 234, 0.08);
            transform: translateX(4px);
        }

        .agent-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            transform: translateX(4px);
        }

        .agent-icon {
            font-size: 18px;
        }

        .agent-badge {
            position: absolute;
            right: 10px;
            background: #d13438;
            color: white;
            padding: 2px 7px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
        }

        .pulse-dot {
            width: 8px;
            height: 8px;
            background: #d13438;
            border-radius: 50%;
            animation: pulse 2s infinite;
            position: absolute;
            right: 10px;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .chat-item {
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            color: #333;
            font-size: 13px;
            transition: all 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-item:hover {
            background: #f0f0f0;
        }

        /* Main Chat Area */
        .main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .welcome-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .welcome-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 40px;
            letter-spacing: -0.5px;
        }

        /* Messages */
        .messages {
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .message {
            margin-bottom: 24px;
            animation: messageSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .avatar.company {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .sender-name {
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        .message-content {
            margin-left: 46px;
            color: #2d3748;
            font-size: 15px;
            line-height: 1.7;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            padding: 16px 20px;
            border-radius: 12px;
            border: 1px solid rgba(0, 0, 0, 0.06);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        /* Critical Banner */
        .critical-banner {
            background: linear-gradient(135deg, #fc8181 0%, #e53e3e 100%);
            color: white;
            padding: 18px 24px;
            margin: 0 46px 20px 46px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(245, 101, 101, 0.2);
        }

        .critical-banner.collapsed {
            padding: 10px 18px;
            background: linear-gradient(135deg, rgba(252, 129, 129, 0.9) 0%, rgba(229, 62, 62, 0.9) 100%);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 8px rgba(245, 101, 101, 0.15);
        }

        .critical-banner.collapsed:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(245, 101, 101, 0.25);
        }

        .banner-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .banner-title {
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .critical-banner.collapsed .banner-title {
            font-size: 12px;
            font-weight: 500;
        }

        .collapse-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .collapse-toggle:hover {
            background: rgba(255,255,255,0.3);
        }

        .banner-body {
            margin-top: 12px;
            font-size: 13px;
            line-height: 1.5;
            opacity: 0.95;
        }

        .banner-actions {
            display: flex;
            gap: 8px;
            margin-top: 14px;
        }

        .banner-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .banner-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .banner-btn.primary {
            background: white;
            color: #d13438;
            border: none;
        }

        .banner-btn.primary:hover {
            background: #f0f0f0;
        }

        .critical-banner.collapsed .banner-body,
        .critical-banner.collapsed .banner-actions {
            display: none;
        }

        /* Update Cards */
        .update-card {
            background: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 16px;
            margin-top: 12px;
        }

        .update-card.important {
            border-left: 3px solid #ffa500;
        }

        .card-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
        }

        .card-desc {
            font-size: 13px;
            color: #666;
            margin-bottom: 10px;
        }

        .card-actions {
            display: flex;
            gap: 8px;
        }

        .card-btn {
            background: white;
            border: 1px solid #d0d0d0;
            color: #333;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .card-btn:hover {
            background: #f0f0f0;
        }

        .card-btn.primary {
            background: #0078d4;
            border-color: #0078d4;
            color: white;
        }

        .card-btn.primary:hover {
            background: #106ebe;
        }

        /* Input Area */
        .input-area {
            padding: 20px;
            max-width: 840px;
            width: 100%;
            margin: 0 auto;
        }

        .input-wrapper {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 16px;
            padding: 14px 18px;
            display: flex;
            align-items: flex-end;
            gap: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
        }

        .input-wrapper:focus-within {
            border-color: rgba(102, 126, 234, 0.6);
            background: white;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }

        .input-wrapper textarea {
            flex: 1;
            background: transparent;
            border: none;
            color: #333;
            font-size: 15px;
            font-family: inherit;
            outline: none;
            resize: none;
            max-height: 120px;
        }

        .input-wrapper textarea::placeholder {
            color: #999;
        }

        .send-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .send-btn:hover {
            transform: scale(1.05) rotate(5deg);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .send-btn:active {
            transform: scale(0.95);
        }

        .tools-bar {
            display: flex;
            gap: 12px;
            margin-top: 12px;
            justify-content: center;
        }

        .tool-btn {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(102, 126, 234, 0.2);
            color: #667eea;
            padding: 10px 18px;
            border-radius: 24px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .tool-btn:hover {
            background: white;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        /* Quick Replies */
        .quick-replies {
            display: flex;
            gap: 10px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .quick-reply {
            background: rgba(102, 126, 234, 0.08);
            border: 1px solid rgba(102, 126, 234, 0.2);
            color: #667eea;
            padding: 10px 16px;
            border-radius: 24px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .quick-reply:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .prototype-label {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #f56565 0%, #c53030 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 24px;
            font-size: 12px;
            font-weight: 700;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(245, 101, 101, 0.4);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Loading indicator for AI typing */
        .typing-indicator {
            display: inline-flex;
            gap: 4px;
            padding: 12px 16px;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            animation: typingDot 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingDot {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        /* Product Tour Styles */
        .tour-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease-in-out;
        }

        .tour-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .tour-spotlight {
            position: fixed;
            border: 3px solid #667eea;
            border-radius: 8px;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7), 0 0 20px rgba(102, 126, 234, 0.8);
            pointer-events: none;
            transition: all 0.3s ease-in-out;
            z-index: 1000;
            display: none;
        }

        .tour-tooltip {
            position: fixed;
            background: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 360px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            animation: tooltipSlideIn 0.3s ease-out;
            display: none;
        }

        @keyframes tooltipSlideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tour-tooltip-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .tour-step-indicator {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .tour-tooltip-title {
            font-size: 18px;
            font-weight: 600;
            color: #201f1e;
            flex: 1;
        }

        .tour-tooltip-content {
            color: #605e5c;
            line-height: 1.6;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .tour-tooltip-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tour-progress {
            font-size: 12px;
            color: #a19f9d;
        }

        .tour-buttons {
            display: flex;
            gap: 8px;
        }

        .tour-btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tour-btn-skip {
            background: #f3f2f1;
            color: #605e5c;
        }

        .tour-btn-skip:hover {
            background: #edebe9;
        }

        .tour-btn-next, .tour-btn-finish {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tour-btn-next:hover, .tour-btn-finish:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .restart-tour-btn {
            margin-top: 16px;
            padding: 10px 14px;
            background: rgba(102, 126, 234, 0.08);
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
            color: #667eea;
            font-weight: 500;
            width: calc(100% - 32px);
            margin-left: 16px;
            margin-right: 16px;
        }

        .restart-tour-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .restart-tour-btn .icon {
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="prototype-label">PROTOTYPE 1: Copilot UX</div>

    <div class="app">
        <!-- Left Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <button class="new-chat-btn">
                    <span>‚ú®</span>
                    <span>New chat</span>
                </button>
            </div>

            <div class="sidebar-section">
                <div class="section-title">Agents</div>
                <div class="agent-item active" onclick="switchAgent('copilot', event)">
                    <span class="agent-icon">ü§ñ</span>
                    <span>Copilot</span>
                </div>
                <div class="agent-item" id="companyAgent" onclick="switchAgent('company', event)">
                    <span class="agent-icon">üè¢</span>
                    <span>Contoso</span>
                    <span class="pulse-dot"></span>
                    <span class="agent-badge">1</span>
                </div>
            </div>

            <div class="sidebar-section" style="flex: 1; overflow-y: auto;">
                <div class="section-title">Chats</div>
                <div class="chat-item">PTO policy questions</div>
                <div class="chat-item">Office location info</div>
                <div class="chat-item">Q4 Results summary</div>
            </div>

            <button class="restart-tour-btn" onclick="restartTour()">
                <span class="icon">üéì</span>
                <span>Restart Tour</span>
            </button>
        </div>

        <!-- Main Chat Area -->
        <div class="main-area">
            <div class="chat-container" id="chatContainer">
                <!-- Welcome Screen -->
                <div class="welcome-container" id="welcomeScreen">
                    <h1 class="welcome-title">Welcome, how can I help?</h1>
                </div>

                <!-- Messages Area -->
                <div class="messages" id="messagesArea" style="display: none;">
                    <!-- Messages will be added here -->
                </div>
            </div>

            <!-- Input Area -->
            <div class="input-area">
                <div class="input-wrapper">
                    <textarea
                        id="messageInput"
                        placeholder="Message Copilot"
                        rows="1"
                        onkeydown="handleEnter(event)"
                        oninput="autoResize(this)"
                    ></textarea>
                    <button class="send-btn" onclick="sendMessage()">‚û§</button>
                </div>
                <div class="tools-bar">
                    <button class="tool-btn">Learn</button>
                    <button class="tool-btn">Find</button>
                    <button class="tool-btn">Summarize</button>
                    <button class="tool-btn">Suggest</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Tour -->
    <div class="tour-overlay" id="tourOverlay"></div>
    <div class="tour-spotlight" id="tourSpotlight"></div>
    <div class="tour-tooltip" id="tourTooltip">
        <div class="tour-tooltip-header">
            <div class="tour-step-indicator" id="tourStepNumber">1</div>
            <div class="tour-tooltip-title" id="tourTitle">Welcome</div>
        </div>
        <div class="tour-tooltip-content" id="tourContent">
            Welcome to the tour!
        </div>
        <div class="tour-tooltip-footer">
            <div class="tour-progress" id="tourProgress">1 of 5</div>
            <div class="tour-buttons">
                <button class="tour-btn tour-btn-skip" onclick="skipTour()">Skip</button>
                <button class="tour-btn tour-btn-next" id="tourNextBtn" onclick="nextTourStep()">Next</button>
                <button class="tour-btn tour-btn-finish" id="tourFinishBtn" onclick="finishTour()" style="display: none;">Finish</button>
            </div>
        </div>
    </div>

    <script>
        let currentAgent = 'copilot';
        const messagesArea = document.getElementById('messagesArea');
        const welcomeScreen = document.getElementById('welcomeScreen');
        const messageInput = document.getElementById('messageInput');

        function switchAgent(agent, evt) {
            currentAgent = agent;

            // Update active state
            document.querySelectorAll('.agent-item').forEach(item => {
                item.classList.remove('active');
            });

            // Find the clicked agent item
            if (evt && evt.target) {
                evt.target.closest('.agent-item').classList.add('active');
            } else {
                // Fallback: find by agent type
                if (agent === 'company') {
                    document.getElementById('companyAgent').classList.add('active');
                } else {
                    document.querySelector('.agent-item').classList.add('active');
                }
            }

            // Clear messages
            messagesArea.innerHTML = '';
            messagesArea.style.display = 'none';
            welcomeScreen.style.display = 'flex';

            // Update welcome title and placeholder based on agent
            const welcomeTitle = document.querySelector('.welcome-title');
            if (agent === 'company') {
                welcomeTitle.textContent = 'How can Contoso help you today?';
                messageInput.placeholder = 'Ask about Contoso...';
            } else {
                welcomeTitle.textContent = 'Welcome, how can I help?';
                messageInput.placeholder = 'Message Copilot';
            }
        }

        function toggleBanner(event) {
            if (event) event.stopPropagation();
            const banner = document.getElementById('criticalBanner');
            const toggle = banner.querySelector('.collapse-toggle');

            banner.classList.toggle('collapsed');
            toggle.textContent = banner.classList.contains('collapsed') ? '‚àí' : '+';
        }

        function handleBannerAction(action, event) {
            if (event) event.stopPropagation();
            const banner = document.getElementById('criticalBanner');
            const badge = document.querySelector('.agent-badge');
            const dot = document.querySelector('.pulse-dot');

            if (action === 'complete') {
                addMessage('company', '‚úÖ Great! Opening the security training portal for you now. Once you complete it, I\'ll mark this as done.');
                banner.style.display = 'none';
                badge.style.display = 'none';
                dot.style.display = 'none';
            } else if (action === 'more') {
                banner.classList.remove('collapsed');
            } else if (action === 'dismiss') {
                addMessage('company', 'No problem. I\'ll remind you tomorrow. The deadline is Jan 31.');
                banner.classList.add('collapsed');
            }
        }

        function askQuestion(question) {
            messageInput.value = question;
            sendMessage();
        }

        function handleEnter(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
        }

        function showTypingIndicator() {
            const indicator = `
                <div class="message" id="typingIndicator">
                    <div class="message-header">
                        <div class="avatar ${currentAgent === 'company' ? 'company' : ''}">${currentAgent === 'company' ? 'üè¢' : 'ü§ñ'}</div>
                        <div class="sender-name">${currentAgent === 'company' ? 'Contoso Assistant' : 'Copilot'}</div>
                    </div>
                    <div class="message-content">
                        <div class="typing-indicator">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                </div>
            `;
            messagesArea.insertAdjacentHTML('beforeend', indicator);
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            welcomeScreen.style.display = 'none';
            messagesArea.style.display = 'block';

            // Add user message
            addMessage('user', message);
            messageInput.value = '';
            messageInput.style.height = 'auto';

            // Show typing indicator
            showTypingIndicator();

            // Get response with realistic delay
            setTimeout(() => {
                hideTypingIndicator();
                const response = getResponse(message);
                addMessage(currentAgent, response);
            }, 1500);
        }

        function addMessage(sender, text) {
            const isUser = sender === 'user';
            const isCompany = sender === 'company';
            const avatar = isUser ? 'üë§' : (isCompany ? 'üè¢' : 'ü§ñ');
            const name = isUser ? 'You' : (isCompany ? 'Contoso Assistant' : 'Copilot');
            const avatarClass = isCompany ? 'company' : '';

            const messageHTML = `
                <div class="message">
                    <div class="message-header">
                        <div class="avatar ${avatarClass}">${avatar}</div>
                        <div class="sender-name">${name}</div>
                    </div>
                    <div class="message-content">${text}</div>
                </div>
            `;

            messagesArea.insertAdjacentHTML('beforeend', messageHTML);

            // Scroll to bottom
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function getResponse(message) {
            const lower = message.toLowerCase();

            if (currentAgent === 'company') {
                // First message - show critical banner
                if (messagesArea.children.length === 1) {
                    const criticalBanner = `
                        <div class="critical-banner collapsed" id="criticalBanner" onclick="toggleBanner()">
                            <div class="banner-header">
                                <div class="banner-title">
                                    ‚ö†Ô∏è Urgent: Security Training Due Jan 31
                                </div>
                                <button class="collapse-toggle" onclick="toggleBanner(event)">‚àí</button>
                            </div>
                            <div class="banner-body">
                                You need to complete mandatory security training and update your password. This is required for compliance and takes about 30 minutes.
                            </div>
                            <div class="banner-actions">
                                <button class="banner-btn primary" onclick="handleBannerAction('complete', event)">Complete Now</button>
                                <button class="banner-btn" onclick="handleBannerAction('more', event)">Tell Me More</button>
                                <button class="banner-btn" onclick="handleBannerAction('dismiss', event)">Remind Later</button>
                            </div>
                        </div>
                    `;
                    messagesArea.insertAdjacentHTML('afterbegin', criticalBanner);
                }

                // Knowledge base responses
                if (lower.includes('urgent') || lower.includes('what')) {
                    return `<strong>Security Training - Due Jan 31</strong><br><br>
                        You need to:<br>
                        1. Complete 30-min security awareness course<br>
                        2. Update your password (12+ characters)<br>
                        3. Pass a short quiz<br><br>
                        This is mandatory for compliance.`;

                } else if (lower.includes('all') || lower.includes('update')) {
                    return `<strong>Your Updates:</strong><br><br>
                        üî¥ Security Training - Due Jan 31<br>
                        üü° Leadership Summit - Register by Feb 15<br>
                        üü° Hybrid Work Schedule - Submit by Jan 31<br>
                        üü¢ Q1 Learning Courses - Browse anytime
                        <div class="update-card important">
                            <div class="card-title">Leadership Summit Registration</div>
                            <div class="card-desc">March 15-17 in Seattle. Early bird closes Feb 15.</div>
                            <div class="card-actions">
                                <button class="card-btn primary">Register</button>
                                <button class="card-btn">Learn More</button>
                            </div>
                        </div>`;

                } else if (lower.includes('pto') || lower.includes('vacation') || lower.includes('time off')) {
                    return `<strong>PTO Policy:</strong><br><br>
                        ‚Ä¢ 20 days annually for full-time employees<br>
                        ‚Ä¢ Accrues at 1.67 days/month<br>
                        ‚Ä¢ Request via Workday at least 2 weeks in advance<br>
                        ‚Ä¢ Up to 5 days can roll over to next year<br>
                        ‚Ä¢ Unused days beyond 5 are forfeited<br><br>
                        <strong>Holidays:</strong> 10 company holidays plus your birthday!`;

                } else if (lower.includes('benefit') || lower.includes('health') || lower.includes('insurance')) {
                    return `<strong>Benefits Overview:</strong><br><br>
                        <strong>Health Insurance:</strong><br>
                        ‚Ä¢ Medical, Dental, Vision coverage<br>
                        ‚Ä¢ Company covers 80% of premiums<br>
                        ‚Ä¢ Enrollment opens Nov 1-15<br><br>
                        <strong>401(k):</strong><br>
                        ‚Ä¢ 6% company match<br>
                        ‚Ä¢ Immediate vesting<br><br>
                        <strong>Other Benefits:</strong><br>
                        ‚Ä¢ $1,500 learning budget annually<br>
                        ‚Ä¢ Gym membership reimbursement ($50/month)<br>
                        ‚Ä¢ Mental health resources through Headspace`;

                } else if (lower.includes('office') || lower.includes('location') || lower.includes('address')) {
                    return `<strong>Contoso Office Locations:</strong><br><br>
                        <strong>Seattle HQ:</strong><br>
                        1234 Innovation Way, Seattle, WA 98101<br>
                        Open: Mon-Fri 7am-7pm<br><br>
                        <strong>NYC Office:</strong><br>
                        567 Broadway, New York, NY 10012<br>
                        Open: Mon-Fri 8am-6pm<br><br>
                        <strong>Austin Office:</strong><br>
                        890 Tech Blvd, Austin, TX 78701<br>
                        Open: Mon-Fri 8am-6pm<br><br>
                        Badge access 24/7 for all locations.`;

                } else if (lower.includes('hybrid') || lower.includes('remote') || lower.includes('work from home') || lower.includes('wfh')) {
                    return `<strong>Hybrid Work Policy:</strong><br><br>
                        Effective Q1 2026, all employees choose their work mode:<br><br>
                        <strong>Fully Remote:</strong> Work from anywhere in your country<br>
                        <strong>Hybrid:</strong> Minimum 2 days/week in office (Tue-Thu core days)<br>
                        <strong>In-Office:</strong> 5 days/week with reserved desk<br><br>
                        Submit your preference in Workday by Jan 31. You can change quarterly.<br><br>
                        Team meetings scheduled on core days (Tue-Thu) when possible.`;

                } else if (lower.includes('summit') || lower.includes('leadership') || lower.includes('conference')) {
                    return `<strong>Annual Leadership Summit 2026</strong><br><br>
                        üìÖ March 15-17, 2026<br>
                        üìç Seattle Convention Center<br><br>
                        <strong>Theme:</strong> "Innovation Through Collaboration"<br><br>
                        <strong>Highlights:</strong><br>
                        ‚Ä¢ Keynote from CEO Sarah Chen<br>
                        ‚Ä¢ 30+ breakout sessions<br>
                        ‚Ä¢ Networking dinner on March 16<br>
                        ‚Ä¢ Product roadmap reveals<br><br>
                        <strong>Early Bird:</strong> $299 (until Feb 15)<br>
                        <strong>Regular:</strong> $399 (after Feb 15)<br><br>
                        Register in Workday ‚Üí Events ‚Üí Leadership Summit`;

                } else if (lower.includes('ceo') || lower.includes('leadership') || lower.includes('executive')) {
                    return `<strong>Leadership Team:</strong><br><br>
                        <strong>Sarah Chen</strong> - CEO<br>
                        Leading Contoso since 2020. Previously VP at Microsoft.<br><br>
                        <strong>Marcus Johnson</strong> - CTO<br>
                        20+ years in cloud infrastructure.<br><br>
                        <strong>Priya Patel</strong> - CPO<br>
                        Former product lead at Google Cloud.<br><br>
                        <strong>James Wilson</strong> - CFO<br>
                        Ex-Goldman Sachs, joined 2022.<br><br>
                        Monthly town halls: Last Thursday of each month at 2pm PT.`;

                } else if (lower.includes('it') || lower.includes('help') || lower.includes('support') || lower.includes('laptop')) {
                    return `<strong>IT Support:</strong><br><br>
                        <strong>Service Desk:</strong><br>
                        ‚Ä¢ Email: helpdesk@contoso.com<br>
                        ‚Ä¢ Phone: 1-800-CONTOSO<br>
                        ‚Ä¢ Chat: Available 24/7 in Teams<br><br>
                        <strong>Common Requests:</strong><br>
                        ‚Ä¢ Password reset: Self-service via portal.contoso.com<br>
                        ‚Ä¢ New equipment: Submit ticket, 2-3 day delivery<br>
                        ‚Ä¢ Software licenses: Auto-approved for approved list<br><br>
                        <strong>Equipment Refresh:</strong> Every 3 years or as needed`;

                } else if (lower.includes('onboard') || lower.includes('new hire') || lower.includes('start date')) {
                    return `<strong>New Hire Onboarding:</strong><br><br>
                        <strong>Week 1:</strong><br>
                        ‚Ä¢ Day 1: Orientation & setup (9am PT)<br>
                        ‚Ä¢ Equipment delivered to your address<br>
                        ‚Ä¢ Complete compliance training<br><br>
                        <strong>First 30 Days:</strong><br>
                        ‚Ä¢ Meet with manager weekly<br>
                        ‚Ä¢ Join team socials<br>
                        ‚Ä¢ Complete role-specific training<br><br>
                        <strong>Buddy Program:</strong><br>
                        You'll be paired with a peer mentor for 90 days.<br><br>
                        Questions? Contact people-ops@contoso.com`;

                } else if (lower.includes('parking') || lower.includes('commute') || lower.includes('transit')) {
                    return `<strong>Commute Benefits:</strong><br><br>
                        <strong>Parking:</strong><br>
                        ‚Ä¢ Reserved spots: $50/month (limited availability)<br>
                        ‚Ä¢ Daily parking: Validated at front desk<br>
                        ‚Ä¢ EV charging: Free at all locations<br><br>
                        <strong>Transit:</strong><br>
                        ‚Ä¢ $200/month transit subsidy<br>
                        ‚Ä¢ Bike storage available<br>
                        ‚Ä¢ Shower facilities on-site<br><br>
                        Enroll in commuter benefits via Workday ‚Üí Benefits ‚Üí Commuter`;

                } else if (lower.includes('food') || lower.includes('lunch') || lower.includes('cafe') || lower.includes('meal')) {
                    return `<strong>Food & Dining:</strong><br><br>
                        <strong>Office Cafeteria:</strong><br>
                        ‚Ä¢ Breakfast: 7-10am (free)<br>
                        ‚Ä¢ Lunch: 11:30am-2pm (subsidized)<br>
                        ‚Ä¢ Snacks & beverages: Available all day (free)<br><br>
                        <strong>Meal Stipend:</strong><br>
                        Remote employees: $15/day meal allowance<br>
                        Use your Contoso Visa card<br><br>
                        <strong>Team Lunches:</strong><br>
                        $500/quarter budget per team`;

                } else if (lower.includes('performance') || lower.includes('review') || lower.includes('promotion')) {
                    return `<strong>Performance & Growth:</strong><br><br>
                        <strong>Review Cycle:</strong><br>
                        ‚Ä¢ Mid-year check-in: June<br>
                        ‚Ä¢ Annual review: December<br>
                        ‚Ä¢ 360 feedback collected in November<br><br>
                        <strong>Promotions:</strong><br>
                        ‚Ä¢ Considered during annual cycle<br>
                        ‚Ä¢ Based on impact, skills, and company values<br>
                        ‚Ä¢ Typical timeline: 18-24 months between levels<br><br>
                        <strong>Career Development:</strong><br>
                        ‚Ä¢ Monthly 1:1s with manager<br>
                        ‚Ä¢ Individual development plans (IDP)<br>
                        ‚Ä¢ Internal mobility encouraged`;

                } else if (lower.includes('culture') || lower.includes('values') || lower.includes('mission')) {
                    return `<strong>Contoso Culture & Values:</strong><br><br>
                        <strong>Our Mission:</strong><br>
                        "Empower every organization to achieve more through innovative cloud solutions"<br><br>
                        <strong>Core Values:</strong><br>
                        ‚Ä¢ üéØ Customer Obsession<br>
                        ‚Ä¢ üöÄ Innovation & Agility<br>
                        ‚Ä¢ ü§ù Collaboration & Respect<br>
                        ‚Ä¢ üí° Growth Mindset<br>
                        ‚Ä¢ üåç Sustainability & Impact<br><br>
                        <strong>ERGs:</strong> 12 employee resource groups including Women in Tech, Pride Network, Black Excellence, and more.`;

                } else if (lower.includes('training') || lower.includes('learn') || lower.includes('course')) {
                    return `<strong>Learning & Development:</strong><br><br>
                        <strong>Learning Budget:</strong><br>
                        $1,500/year per employee for:<br>
                        ‚Ä¢ Online courses (Coursera, Udemy, Pluralsight)<br>
                        ‚Ä¢ Conferences & workshops<br>
                        ‚Ä¢ Certifications (AWS, Azure, GCP, etc.)<br>
                        ‚Ä¢ Books & learning materials<br><br>
                        <strong>Internal Programs:</strong><br>
                        ‚Ä¢ Lunch & Learns (every Friday)<br>
                        ‚Ä¢ Tech Talks (bi-weekly)<br>
                        ‚Ä¢ Leadership Academy (quarterly cohorts)<br>
                        ‚Ä¢ Mentorship program<br><br>
                        Submit requests via Workday ‚Üí Learning ‚Üí Request Training`;

                } else {
                    setTimeout(() => {
                        document.querySelectorAll('.quick-reply').forEach(btn => {
                            btn.addEventListener('click', function() {
                                askQuestion(this.textContent);
                            });
                        });
                    }, 100);
                    return 'I can help with company information! Try asking about:<br><br>‚Ä¢ Benefits & PTO<br>‚Ä¢ Office locations & hybrid work<br>‚Ä¢ IT support<br>‚Ä¢ Training & development<br>‚Ä¢ Company culture & values<br>‚Ä¢ Performance reviews<br>‚Ä¢ Leadership team<br><br>Or check out these quick options:<div class="quick-replies"><button class="quick-reply">Show all updates</button><button class="quick-reply">Benefits overview</button><button class="quick-reply">Hybrid work policy</button></div>';
                }
            } else {
                return 'I can help with that! For company-specific information, try chatting with your Contoso assistant in the sidebar.';
            }
        }

        // Set default placeholder
        messageInput.placeholder = 'Message Copilot';

        // Product Tour
        let currentTourStep = 0;
        const tourSteps = [
            {
                title: "Welcome to Contoso Copilot!",
                content: "This quick tour will show you how to get the most out of your AI assistant. Let's get started!<br><br><small style='opacity: 0.7;'>Tip: Press Ctrl+Shift+T anytime to restart this tour</small>",
                target: null,
                position: "center"
            },
            {
                title: "Choose Your Agent",
                content: "Switch between general Copilot and your company's Contoso assistant. The Contoso agent has access to company policies, benefits, and internal information.",
                target: "#companyAgent",
                position: "right"
            },
            {
                title: "Start New Conversations",
                content: "Click here anytime to start a fresh conversation. Each chat is saved in your history below.",
                target: ".new-chat-btn",
                position: "right"
            },
            {
                title: "Ask Anything",
                content: "Type your questions here. Ask about PTO, benefits, office locations, or anything else! The AI understands natural language.",
                target: "#messageInput",
                position: "top"
            },
            {
                title: "You're All Set!",
                content: "That's it! Start by switching to the Contoso agent and asking a question. Your AI assistant is here to help 24/7.",
                target: null,
                position: "center"
            }
        ];

        function startTour() {
            currentTourStep = 0;
            document.getElementById('tourOverlay').classList.add('active');
            showTourStep();
        }

        function showTourStep() {
            const step = tourSteps[currentTourStep];
            const tooltip = document.getElementById('tourTooltip');
            const spotlight = document.getElementById('tourSpotlight');

            // Update content
            document.getElementById('tourStepNumber').textContent = currentTourStep + 1;
            document.getElementById('tourTitle').textContent = step.title;
            document.getElementById('tourContent').innerHTML = step.content;
            document.getElementById('tourProgress').textContent = `${currentTourStep + 1} of ${tourSteps.length}`;

            // Show/hide buttons
            const nextBtn = document.getElementById('tourNextBtn');
            const finishBtn = document.getElementById('tourFinishBtn');
            if (currentTourStep === tourSteps.length - 1) {
                nextBtn.style.display = 'none';
                finishBtn.style.display = 'block';
            } else {
                nextBtn.style.display = 'block';
                finishBtn.style.display = 'none';
            }

            positionTourElements();
        }

        function positionTourElements() {
            const step = tourSteps[currentTourStep];
            const tooltip = document.getElementById('tourTooltip');
            const spotlight = document.getElementById('tourSpotlight');

            // Reset transform for positioning
            tooltip.style.transform = '';

            // Position spotlight and tooltip
            if (step.target) {
                const targetEl = document.querySelector(step.target);
                if (targetEl) {
                    const rect = targetEl.getBoundingClientRect();

                    // Show and position spotlight
                    spotlight.style.display = 'block';
                    spotlight.style.top = (rect.top - 8) + 'px';
                    spotlight.style.left = (rect.left - 8) + 'px';
                    spotlight.style.width = (rect.width + 16) + 'px';
                    spotlight.style.height = (rect.height + 16) + 'px';

                    // Position tooltip
                    tooltip.style.display = 'block';
                    const tooltipRect = tooltip.getBoundingClientRect();

                    if (step.position === 'left') {
                        tooltip.style.top = (rect.top + rect.height / 2 - tooltipRect.height / 2) + 'px';
                        tooltip.style.left = (rect.left - tooltipRect.width - 20) + 'px';
                    } else if (step.position === 'top') {
                        tooltip.style.top = (rect.top - tooltipRect.height - 20) + 'px';
                        tooltip.style.left = (rect.left + rect.width / 2 - tooltipRect.width / 2) + 'px';
                    } else if (step.position === 'right') {
                        tooltip.style.top = (rect.top + rect.height / 2 - tooltipRect.height / 2) + 'px';
                        tooltip.style.left = (rect.right + 20) + 'px';
                    } else {
                        tooltip.style.top = (rect.bottom + 20) + 'px';
                        tooltip.style.left = (rect.left + rect.width / 2 - tooltipRect.width / 2) + 'px';
                    }
                } else {
                    positionTooltipCenter();
                }
            } else {
                spotlight.style.display = 'none';
                positionTooltipCenter();
            }
        }

        function positionTooltipCenter() {
            const tooltip = document.getElementById('tourTooltip');
            tooltip.style.display = 'block';
            tooltip.style.top = '50%';
            tooltip.style.left = '50%';
            tooltip.style.transform = 'translate(-50%, -50%)';
        }

        function nextTourStep() {
            if (currentTourStep < tourSteps.length - 1) {
                currentTourStep++;
                showTourStep();
            }
        }

        function skipTour() {
            endTour();
        }

        function finishTour() {
            endTour();
        }

        function endTour() {
            document.getElementById('tourOverlay').classList.remove('active');
            document.getElementById('tourSpotlight').style.display = 'none';
            document.getElementById('tourTooltip').style.display = 'none';
            localStorage.setItem('contosoTourCompleted', 'true');
        }

        function restartTour() {
            localStorage.removeItem('contosoTourCompleted');
            startTour();
        }

        // Check if first visit and start tour
        function checkPageReady() {
            const tourCompleted = localStorage.getItem('contosoTourCompleted');
            if (tourCompleted) return;

            // Check if all key elements are rendered and visible
            const newChatBtn = document.querySelector('.new-chat-btn');
            const companyAgent = document.getElementById('companyAgent');
            const inputArea = document.querySelector('.input-area');

            if (newChatBtn && newChatBtn.offsetParent !== null &&
                companyAgent && companyAgent.offsetParent !== null &&
                inputArea && inputArea.offsetParent !== null) {
                // All elements are ready, start tour
                try {
                    startTour();
                } catch(e) {
                    console.error('Tour failed to start:', e);
                    document.getElementById('tourOverlay').classList.remove('active');
                }
            } else {
                // Not ready yet, check again in 500ms
                setTimeout(checkPageReady, 500);
            }
        }

        // Start checking after initial load
        window.addEventListener('load', function() {
            setTimeout(checkPageReady, 1000);
        });

        // Keyboard shortcut to restart tour: Ctrl+Shift+T
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'T') {
                e.preventDefault();
                localStorage.removeItem('contosoTourCompleted');
                startTour();
            }
        });
    </script>
</body>
</html>