<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contoso AI Workspace - Where Intelligence Meets Work</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0066FF;
            --primary-glow: rgba(0, 102, 255, 0.3);
            --secondary: #7B61FF;
            --accent: #FF6B9D;
            --success: #00D9A3;
            --bg-dark: #0A0A0F;
            --bg-medium: #12121A;
            --bg-light: #1A1A28;
            --surface: #20203A;
            --surface-hover: #2A2A45;
            --text-primary: #FFFFFF;
            --text-secondary: #B8B8D1;
            --text-tertiary: #7E7E9A;
            --border: rgba(255, 255, 255, 0.08);
            --glow-primary: 0 0 20px rgba(0, 102, 255, 0.4);
            --glow-secondary: 0 0 20px rgba(123, 97, 255, 0.4);
            --glow-accent: 0 0 20px rgba(255, 107, 157, 0.4);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            overflow: hidden;
        }

        /* Ambient Background Animation */
        .ambient-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
        }

        .ambient-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.08;
            animation: none;
        }

        .orb-1 {
            width: 400px;
            height: 400px;
            background: var(--primary);
            top: -100px;
            left: -100px;
            animation-delay: 0s;
        }

        .orb-2 {
            width: 500px;
            height: 500px;
            background: var(--secondary);
            bottom: -150px;
            right: -150px;
            animation-delay: 5s;
        }

        .orb-3 {
            width: 350px;
            height: 350px;
            background: var(--accent);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation-delay: 10s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(10px, -10px) scale(1.02); }
            50% { transform: translate(-10px, 10px) scale(0.98); }
            75% { transform: translate(10px, 15px) scale(1.01); }
        }

        /* Main Container */
        .container {
            position: relative;
            z-index: 1;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Minimal Header */
        .header {
            padding: 20px 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(10, 10, 15, 0.6);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-mark {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            box-shadow: var(--glow-primary);
        }

        .workspace-title {
            font-size: 14px;
            font-weight: 500;
            opacity: 0.6;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .icon-button {
            width: 36px;
            height: 36px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 18px;
        }

        .icon-button:hover {
            background: var(--surface-hover);
            border-color: var(--primary);
            box-shadow: var(--glow-primary);
        }

        /* Main Workspace */
        .workspace {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 600px;
            overflow: hidden;
            position: relative;
        }

        /* Content Stream */
        .content-stream {
            padding: 40px;
            overflow-y: auto;
            position: relative;
        }

        .content-stream::-webkit-scrollbar {
            width: 4px;
        }

        .content-stream::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 2px;
        }

        .stream-header {
            margin-bottom: 40px;
        }

        .greeting {
            font-size: 14px;
            color: var(--text-tertiary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-badge {
            padding: 4px 10px;
            background: var(--primary);
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: var(--glow-primary);
            animation: pulse-glow 3s infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 10px var(--primary-glow); }
            50% { box-shadow: 0 0 25px var(--primary-glow); }
        }

        .stream-title {
            font-size: 48px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--text-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 12px;
        }

        .stream-subtitle {
            font-size: 18px;
            color: var(--text-secondary);
        }

        /* Insight Cards */
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .insight-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .insight-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .insight-card.company-news::before {
            background: linear-gradient(90deg, var(--accent), var(--secondary));
        }

        .insight-card:hover::before {
            opacity: 1;
        }

        .insight-card.company-news {
            background: linear-gradient(135deg, rgba(255, 107, 157, 0.03) 0%, rgba(123, 97, 255, 0.03) 100%);
        }

        .insight-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary);
            box-shadow: var(--glow-primary);
        }

        .insight-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 16px;
            background: rgba(0, 102, 255, 0.1);
        }

        .insight-card.company-news .insight-icon {
            background: rgba(255, 107, 157, 0.1);
        }

        .insight-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .insight-desc {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .insight-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 13px;
            color: var(--text-tertiary);
        }

        .ai-badge-small {
            padding: 3px 8px;
            background: rgba(0, 102, 255, 0.15);
            border-radius: 6px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--primary);
        }

        .insight-card.company-news .ai-badge-small {
            background: rgba(255, 107, 157, 0.15);
            color: var(--accent);
        }

        .insight-action {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: var(--primary);
            font-size: 13px;
            font-weight: 500;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .insight-card.company-news .insight-action {
            color: var(--accent);
        }

        .insight-card:hover .insight-action {
            opacity: 1;
        }

        /* Agent Panel */
        .agent-panel {
            background: #12121A;
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            position: relative;
            transform: translateZ(0);
            backface-visibility: hidden;
            height: 100%;
            overflow: hidden;
        }

        /* Agent Header */
        .agent-header {
            padding: 32px;
            border-bottom: 1px solid var(--border);
        }

        .agent-presence {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 24px;
        }

        .agent-avatar-large {
            width: 72px;
            height: 72px;
            border-radius: 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            box-shadow: var(--glow-primary);
            position: relative;
            animation: none;
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); box-shadow: var(--glow-primary); }
            50% { transform: scale(1.02); box-shadow: 0 0 25px rgba(0, 102, 255, 0.5); }
        }

        .agent-pulse {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 16px;
            height: 16px;
            background: var(--success);
            border-radius: 50%;
            border: 3px solid var(--bg-medium);
            box-shadow: 0 0 10px var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        .agent-identity {
            flex: 1;
        }

        .agent-name {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .agent-role {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .agent-capabilities {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .capability-tag {
            padding: 6px 12px;
            background: rgba(0, 102, 255, 0.15);
            border: 1px solid rgba(0, 102, 255, 0.3);
            border-radius: 8px;
            font-size: 12px;
            color: var(--primary);
        }

        /* Agent Switcher */
        .agent-switcher {
            display: flex;
            gap: 8px;
            padding: 16px;
            background: var(--surface);
            border-radius: 12px;
            overflow-x: auto;
        }

        .agent-option {
            padding: 12px 16px;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .agent-option:hover {
            background: var(--surface-hover);
            border-color: var(--primary);
        }

        .agent-option.active {
            background: var(--primary);
            border-color: var(--primary);
            box-shadow: var(--glow-primary);
        }

        /* Conversation Area */
        .conversation {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            gap: 24px;
            min-height: 0;
        }

        .conversation::-webkit-scrollbar {
            width: 4px;
        }

        .conversation::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 2px;
        }

        /* AI Proactive Messages */
        .message-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message {
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: var(--text-tertiary);
        }

        .message-bubble {
            max-width: 75%;
            padding: 16px 20px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            font-size: 15px;
            line-height: 1.6;
        }

        .message.user .message-bubble {
            background: var(--primary);
            border-color: var(--primary);
            box-shadow: var(--glow-primary);
        }

        /* Proactive Insight */
        .proactive-insight {
            background: linear-gradient(135deg, rgba(0, 102, 255, 0.1) 0%, rgba(123, 97, 255, 0.1) 100%);
            border: 1px solid rgba(0, 102, 255, 0.3);
            border-radius: 16px;
            padding: 20px;
            margin: 12px 0;
        }

        .proactive-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            font-size: 13px;
            color: var(--primary);
            font-weight: 600;
        }

        .sparkle {
            animation: sparkle 2s infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 1; transform: rotate(0deg) scale(1); }
            50% { opacity: 0.7; transform: rotate(180deg) scale(1.2); }
        }

        .proactive-content {
            font-size: 15px;
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .proactive-actions {
            display: flex;
            gap: 8px;
        }

        .quick-action {
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-action:hover {
            background: var(--primary);
            border-color: var(--primary);
            box-shadow: var(--glow-primary);
        }

        /* Input Area */
        .input-area {
            padding: 24px 32px;
            border-top: 1px solid var(--border);
            background: rgba(18, 18, 26, 0.9);
            backdrop-filter: blur(20px);
        }

        .input-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .input-field {
            flex: 1;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px 20px;
            font-size: 15px;
            color: var(--text-primary);
            font-family: inherit;
            resize: none;
            transition: all 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.1);
        }

        .send-button {
            width: 52px;
            height: 52px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border: none;
            border-radius: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: var(--glow-primary);
        }

        .send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px var(--primary-glow);
        }

        .send-button:active {
            transform: scale(0.95);
        }

        /* Context-Aware Banner */

        /* Predictive Panel */
        .predictive-panel {
            position: fixed;
            top: 100px;
            right: 30px;
            width: 400px;
            background: var(--surface);
            border: 1px solid var(--primary);
            border-radius: 20px;
            padding: 28px;
            box-shadow: var(--glow-primary), 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideInRight 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 2000;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100px);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        .predictive-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .predictive-icon {
            font-size: 28px;
            animation: rotate 3s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .predictive-label {
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--primary);
        }

        .predictive-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .predictive-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .predictive-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 24px;
        }

        .predictive-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            font-size: 14px;
            padding: 12px;
            background: rgba(0, 102, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(0, 102, 255, 0.1);
        }

        .predictive-item-icon {
            font-size: 16px;
            margin-top: 2px;
        }

        .predictive-actions {
            display: flex;
            gap: 12px;
        }

        .predictive-btn {
            flex: 1;
            padding: 14px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 600;
        }

        .predictive-btn:hover {
            background: var(--surface-hover);
            transform: translateY(-2px);
        }

        .predictive-btn.primary {
            background: var(--primary);
            border-color: var(--primary);
            box-shadow: var(--glow-primary);
        }

        .predictive-btn.primary:hover {
            background: var(--secondary);
            box-shadow: var(--glow-secondary);
        }

        /* Agent Thinking Overlay */
        .agent-thinking {
            position: absolute;
            top: -180px;
            left: 50%;
            transform: translateX(-50%);
            width: 280px;
            background: var(--surface);
            border: 1px solid var(--primary);
            border-radius: 16px;
            padding: 16px 20px;
            box-shadow: var(--glow-primary);
            animation: thoughtBubble 0.4s ease;
        }

        @keyframes thoughtBubble {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0) scale(1);
            }
        }

        .agent-thinking::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid var(--primary);
        }

        .thinking-steps {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .thinking-step {
            font-size: 13px;
            color: var(--text-secondary);
            padding: 8px 12px;
            background: rgba(0, 102, 255, 0.05);
            border-radius: 8px;
            animation: fadeInStep 0.5s ease;
            position: relative;
            padding-left: 32px;
        }

        .thinking-step::before {
            content: '‚ö°';
            position: absolute;
            left: 10px;
            animation: pulse 1s infinite;
        }

        @keyframes fadeInStep {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .thinking-step.complete {
            color: var(--success);
            background: rgba(0, 217, 163, 0.05);
        }

        .thinking-step.complete::before {
            content: '‚úì';
            color: var(--success);
            animation: none;
        }

        /* Multi-Agent Collaboration */
        .agent-collab-container {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            align-items: flex-end;
        }

        .collab-agent {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            animation: agentJoin 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes agentJoin {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .collab-avatar {
            width: 48px;
            height: 48px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border: 2px solid var(--border);
        }

        .collab-avatar.nova {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .collab-avatar.finance {
            background: linear-gradient(135deg, #FFB800, #FF8C00);
        }

        .collab-avatar.hr {
            background: linear-gradient(135deg, var(--success), #00B894);
        }

        .collab-avatar.it {
            background: linear-gradient(135deg, var(--secondary), #6C5CE7);
        }

        .collab-name {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-tertiary);
        }

        .collab-message {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px 20px;
            margin-bottom: 12px;
            position: relative;
        }

        .collab-message.finance {
            border-color: rgba(255, 184, 0, 0.3);
            background: rgba(255, 184, 0, 0.05);
        }

        .collab-message.hr {
            border-color: rgba(0, 217, 163, 0.3);
            background: rgba(0, 217, 163, 0.05);
        }

        .collab-message.it {
            border-color: rgba(123, 97, 255, 0.3);
            background: rgba(123, 97, 255, 0.05);
        }

        .collab-message-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 13px;
            font-weight: 600;
        }

        .collab-message-header .agent-icon {
            font-size: 16px;
        }

        /* Confidence Indicator */
        .confidence-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 12px;
            padding: 10px 14px;
            background: rgba(0, 102, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(0, 102, 255, 0.1);
        }

        .confidence-bar {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            border-radius: 3px;
            transition: width 1s ease;
        }

        .confidence-text {
            font-size: 12px;
            font-weight: 600;
            color: var(--primary);
            white-space: nowrap;
        }

        .confidence-detail {
            font-size: 11px;
            color: var(--text-tertiary);
            cursor: pointer;
            text-decoration: underline;
        }

        .confidence-detail:hover {
            color: var(--primary);
        }

        /* Detail Panel Overlay */
        .detail-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 10, 15, 0.7);
            backdrop-filter: blur(8px);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .detail-panel {
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            background: var(--surface);
            border-radius: 20px;
            overflow: hidden;
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(40px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .detail-header {
            padding: 32px;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(135deg, rgba(0, 102, 255, 0.05) 0%, rgba(123, 97, 255, 0.05) 100%);
        }

        .detail-header.company-news {
            background: linear-gradient(135deg, rgba(255, 107, 157, 0.05) 0%, rgba(123, 97, 255, 0.05) 100%);
        }

        .detail-header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .detail-icon {
            width: 64px;
            height: 64px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            background: rgba(0, 102, 255, 0.1);
        }

        .detail-header.company-news .detail-icon {
            background: rgba(255, 107, 157, 0.1);
        }

        .detail-close {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.2s;
        }

        .detail-close:hover {
            background: var(--surface-hover);
            border-color: var(--primary);
            color: var(--text-primary);
        }

        .detail-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 12px;
            line-height: 1.3;
        }

        .detail-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .detail-body {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
        }

        .detail-body::-webkit-scrollbar {
            width: 6px;
        }

        .detail-body::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .detail-section {
            margin-bottom: 32px;
        }

        .detail-section-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-section-content {
            font-size: 15px;
            line-height: 1.8;
            color: var(--text-primary);
        }

        .detail-section-content p {
            margin: 0;
        }

        .detail-formatted {
            line-height: 1.9;
        }

        .detail-formatted strong {
            color: var(--primary);
            font-weight: 700;
        }

        .detail-formatted br {
            display: block;
            content: "";
            margin-top: 0.5em;
        }

        .detail-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .detail-list-item {
            padding: 16px;
            background: rgba(0, 102, 255, 0.05);
            border-left: 3px solid var(--primary);
            border-radius: 8px;
            font-size: 15px;
            line-height: 1.6;
        }

        .detail-footer {
            padding: 24px 32px;
            border-top: 1px solid var(--border);
            background: var(--bg-light);
            display: flex;
            gap: 12px;
        }

        .detail-action-btn {
            flex: 1;
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .detail-action-btn.secondary {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-primary);
        }

        .detail-action-btn.secondary:hover {
            background: var(--surface-hover);
            border-color: var(--primary);
        }

        .detail-action-btn.primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border: none;
            color: white;
            box-shadow: var(--glow-primary);
        }

        .detail-action-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(0, 102, 255, 0.5);
        }
        .context-banner {
            background: linear-gradient(90deg, rgba(255, 107, 157, 0.15), rgba(123, 97, 255, 0.15));
            border: 1px solid rgba(255, 107, 157, 0.3);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .context-icon {
            font-size: 24px;
        }

        .context-text {
            flex: 1;
            font-size: 14px;
            line-height: 1.5;
        }

        .context-dismiss {
            width: 24px;
            height: 24px;
            background: transparent;
            border: none;
            color: var(--text-tertiary);
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .context-dismiss:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 40px;
        }

        .empty-icon {
            font-size: 80px;
            margin-bottom: 24px;
            animation: float 3s infinite ease-in-out;
        }

        .empty-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .empty-desc {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 32px;
            max-width: 400px;
        }

        .starter-prompts {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            max-width: 420px;
        }

        .starter-prompt {
            padding: 16px 20px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }

        .starter-prompt:hover {
            background: var(--surface-hover);
            border-color: var(--primary);
            transform: translateX(8px);
            box-shadow: var(--glow-primary);
        }

        .starter-prompt-text {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .starter-prompt-hint {
            font-size: 13px;
            color: var(--text-tertiary);
        }
    </style>
</head>
<body>
    <!-- Ambient Background -->
    <div class="ambient-bg">
        <div class="ambient-orb orb-1"></div>
        <div class="ambient-orb orb-2"></div>
        <div class="ambient-orb orb-3"></div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Minimal Header -->
        <header class="header">
            <div class="logo-area">
                <div class="logo-mark">C</div>
                <span class="workspace-title">Contoso AI Workspace</span>
            </div>
            <div class="header-actions">
                <button class="icon-button" title="Notifications">üîî</button>
                <button class="icon-button" title="Settings">‚öôÔ∏è</button>
                <button class="icon-button" title="Profile">üë§</button>
            </div>
        </header>

        <!-- Main Workspace -->
        <div class="workspace">
            <!-- Content Stream -->
            <div class="content-stream">
                <div class="stream-header">
                    <div class="greeting">
                        <span>Good morning, Alex</span>
                        <span class="ai-badge">AI Curated</span>
                    </div>
                    <h1 class="stream-title">Your Intelligent Feed</h1>
                    <p class="stream-subtitle">Insights and updates personalized by AI, ready when you are</p>
                </div>

                <div class="insights-grid" id="insightsGrid">
                    <!-- Generated by JS -->
                </div>
            </div>

            <!-- Agent Panel -->
            <div class="agent-panel">
                <div class="agent-header">
                    <div class="agent-presence">
                        <div class="agent-avatar-large">
                            ü§ñ
                            <div class="agent-pulse"></div>
                        </div>
                        <div class="agent-identity">
                            <h2 class="agent-name">Nova</h2>
                            <p class="agent-role">Your AI Workplace Companion</p>
                            <div class="agent-capabilities">
                                <span class="capability-tag">Proactive</span>
                                <span class="capability-tag">Context-Aware</span>
                                <span class="capability-tag">Always Learning</span>
                            </div>
                        </div>
                    </div>

                    <div class="agent-switcher">
                        <button class="agent-option active">üíº Nova</button>
                        <button class="agent-option">üí∞ Finance</button>
                        <button class="agent-option">üéØ HR</button>
                        <button class="agent-option">‚öôÔ∏è IT</button>
                    </div>
                </div>

                <div class="conversation" id="conversation">
                    <div class="empty-state" id="emptyState">
                        <div class="empty-icon">‚ú®</div>
                        <h3 class="empty-title">I'm here to help</h3>
                        <p class="empty-desc">I learn from your patterns and proactively surface insights. Try asking me anything or click a card to dive deeper.</p>

                        <div class="starter-prompts">
                            <div class="starter-prompt" onclick="sendPrompt('What should I focus on today?')">
                                <div class="starter-prompt-text">üéØ What should I focus on today?</div>
                                <div class="starter-prompt-hint">Get AI-prioritized tasks</div>
                            </div>
                            <div class="starter-prompt" onclick="sendPrompt('Summarize what I missed')">
                                <div class="starter-prompt-text">üìä Summarize what I missed</div>
                                <div class="starter-prompt-hint">Catch up intelligently</div>
                            </div>
                            <div class="starter-prompt" onclick="sendPrompt('Who should I connect with?')">
                                <div class="starter-prompt-text">ü§ù Who should I connect with?</div>
                                <div class="starter-prompt-hint">Network recommendations</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="input-area">
                    <div class="input-wrapper">
                        <textarea
                            class="input-field"
                            placeholder="Ask me anything, or I'll proactively help you..."
                            rows="1"
                            id="userInput"
                        ></textarea>
                        <button class="send-button" onclick="sendMessage()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Insights Data - Mix of AI insights and company news
        const insights = [
            {
                icon: 'üìä',
                title: 'Q1 Performance: You\'re in the top 10%',
                desc: 'Your team exceeded OKRs by 35%. Nova identified key factors driving this success.',
                meta: '2 hours ago ‚Ä¢ Personalized',
                action: 'View analysis',
                type: 'ai-insight'
            },
            {
                icon: 'üöÄ',
                title: 'Company News: Record Revenue Growth',
                desc: 'Contoso achieves 35% YoY growth. Nova thinks this impacts your Q2 planning‚Äîask about next steps.',
                meta: '3 hours ago ‚Ä¢ Company News',
                action: 'Ask Nova',
                type: 'company-news'
            },
            {
                icon: 'üéØ',
                title: 'Action needed: Budget approval deadline',
                desc: 'Your Q2 budget request needs approval by Friday. Nova can help you prepare talking points.',
                meta: '3 hours ago ‚Ä¢ High priority',
                action: 'Get help',
                type: 'ai-insight'
            },
            {
                icon: 'üè•',
                title: 'Benefits Update: Mental Health Programs',
                desc: 'New therapy sessions and wellness coaching available. Nova noticed you haven\'t enrolled yet.',
                meta: '5 hours ago ‚Ä¢ Benefits',
                action: 'Learn more',
                type: 'company-news'
            },
            {
                icon: 'üí°',
                title: 'New learning path recommended',
                desc: 'Based on your current projects, Nova suggests these courses to level up your skills.',
                meta: '5 hours ago ‚Ä¢ Career growth',
                action: 'Explore courses',
                type: 'ai-insight'
            },
            {
                icon: 'üé§',
                title: 'All-Hands: Product Roadmap 2024',
                desc: 'This Friday at 2pm. Nova can brief you on discussion topics based on your team\'s work.',
                meta: '1 day ago ‚Ä¢ Events',
                action: 'Get briefed',
                type: 'company-news'
            },
            {
                icon: 'ü§ù',
                title: 'Connect with Sarah from Design',
                desc: 'You both worked on similar challenges. Nova thinks a conversation could spark ideas.',
                meta: '1 day ago ‚Ä¢ Networking',
                action: 'Schedule coffee',
                type: 'ai-insight'
            },
            {
                icon: 'üíº',
                title: 'Policy Update: Hybrid Work Changes',
                desc: '3 days remote per week now allowed. Nova analyzed how this affects your team\'s schedule.',
                meta: '1 day ago ‚Ä¢ Policies',
                action: 'See impact',
                type: 'company-news'
            },
            {
                icon: 'üéâ',
                title: 'Team milestone: 10K customers!',
                desc: 'Your product just hit 10,000 active users. The team is celebrating in the all-hands today.',
                meta: '1 day ago ‚Ä¢ Company news',
                action: 'Join celebration',
                type: 'company-news'
            },
            {
                icon: 'üî¨',
                title: 'Innovation: New AI Research Lab',
                desc: 'Opening in Seattle. Nova identified 3 collaboration opportunities for your projects.',
                meta: '2 days ago ‚Ä¢ Company News',
                action: 'Explore',
                type: 'company-news'
            },
            {
                icon: 'üéì',
                title: 'Hackathon Registration Open',
                desc: 'Annual 48-hour event starts next month. Nova can suggest project ideas based on your interests.',
                meta: '2 days ago ‚Ä¢ Events',
                action: 'Get ideas',
                type: 'company-news'
            },
            {
                icon: 'üí∞',
                title: 'New Benefit: Student Loan Assistance',
                desc: 'Up to $10K annually available. Nova calculated your potential savings and eligibility.',
                meta: '3 days ago ‚Ä¢ Benefits',
                action: 'Calculate',
                type: 'company-news'
            }
        ];

        // Render insights
        function renderInsights() {
            const grid = document.getElementById('insightsGrid');
            grid.innerHTML = insights.map((insight, i) => `
                <div class="insight-card ${insight.type}" onclick="exploreInsight(${i})">
                    <div class="insight-icon">${insight.icon}</div>
                    <div class="insight-title">${insight.title}</div>
                    <div class="insight-desc">${insight.desc}</div>
                    <div class="insight-meta">
                        <span>${insight.meta}</span>
                        ${insight.type === 'ai-insight' ? '<span class="ai-badge-small">AI</span>' : '<span class="ai-badge-small">News</span>'}
                        <span class="insight-action">${insight.action} ‚Üí</span>
                    </div>
                </div>
            `).join('');
        }

        // Hide empty state
        function hideEmptyState() {
            const emptyState = document.getElementById('emptyState');
            if (emptyState) emptyState.style.display = 'none';
        }

        // Add AI message - REMOVED - Using enhanced version below with confidence scores

        // Add user message
        function addUserMessage(text) {
            hideEmptyState();
            const conversation = document.getElementById('conversation');

            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            messageDiv.innerHTML = `
                <div class="message-avatar">üë§</div>
                <div class="message-bubble">${text}</div>
            `;

            conversation.appendChild(messageDiv);
            conversation.scrollTop = conversation.scrollHeight;
        }

        // Add context banner
        function addContextBanner(text, icon = 'üìå') {
            const conversation = document.getElementById('conversation');

            const banner = document.createElement('div');
            banner.className = 'context-banner';
            banner.innerHTML = `
                <div class="context-icon">${icon}</div>
                <div class="context-text">${text}</div>
                <button class="context-dismiss" onclick="this.parentElement.remove()">‚úï</button>
            `;

            conversation.appendChild(banner);
            conversation.scrollTop = conversation.scrollHeight;
        }

        // Detailed responses for each insight
        const insightResponses = {
            0: { // Q1 Performance
                initial: "Excellent question about your Q1 performance! I've analyzed your team's data across 15 key metrics. Let me break down what drove your success.",
                detail: "Your team exceeded OKRs by 35%, placing you in the top 10% company-wide. The key factors were: (1) 28% faster sprint velocity through improved automation, (2) 92% customer satisfaction on delivered features, and (3) Cross-team collaboration that reduced blockers by 40%. Would you like me to create a presentation deck for leadership or identify patterns to replicate in Q2?",
                confidence: 94
            },
            1: { // Company Revenue
                initial: "This revenue milestone is significant for your team. Let me connect the dots between this company achievement and your Q2 planning.",
                detail: "Contoso's 35% YoY growth means increased budgets for innovation projects.<br><br>Based on your team's focus areas, I predict:<br><br><strong>(1) 20% budget increase</strong> for your cloud infrastructure initiatives<br><br><strong>(2) New headcount approval</strong> for 3 positions you've been requesting<br><br><strong>(3) Executive spotlight</strong> on teams like yours driving customer adoption<br><br>I recommend adjusting your Q2 OKRs to align with this growth trajectory.",
                confidence: 89
            },
            2: { // Budget Approval
                initial: "Your budget deadline is critical. I've prepared talking points based on successful approvals from similar teams this quarter.",
                detail: "Your Q2 budget request ($450K) needs approval by Friday.<br><br>I've analyzed 12 similar requests‚Äîhere's what worked:<br><br><strong>(1) ROI projections</strong> showing 3.2x return within 6 months<br><br><strong>(2) Competitive analysis</strong> proving we're under-investing vs. peers<br><br><strong>(3) Risk mitigation</strong> if we don't invest<br><br>I can draft an executive summary, schedule prep time with your finance partner, or create visual aids for the approval meeting. What would help most?",
                confidence: 92
            },
            3: { // Mental Health Benefits
                initial: "I noticed you haven't explored these new mental health benefits yet. Let me explain what's available and why it might be valuable for you.",
                detail: "The new program offers:<br><br><strong>(1) 12 free therapy sessions</strong> annually (normally $2,400 value)<br><br><strong>(2) 24/7 crisis support hotline</strong><br><br><strong>(3) Meditation app subscriptions</strong><br><br><strong>(4) Mental health days</strong> that don't count against PTO<br><br>Based on your calendar patterns (late meetings, weekend work), these resources could improve work-life balance. Enrollment takes 5 minutes. Want me to walk you through it or send the link?",
                confidence: 88
            },
            4: { // Learning Path
                initial: "I've curated a learning path specifically matched to your current projects and career trajectory. Here's why these courses matter.",
                detail: "Based on your work on microservices architecture and upcoming cloud migration, I recommend:<br><br><strong>(1) 'Advanced Kubernetes Orchestration'</strong><br>4 hours, directly applicable to your Q2 project<br><br><strong>(2) 'Site Reliability Engineering Fundamentals'</strong><br>Matches your on-call rotation starting next month<br><br><strong>(3) 'Technical Leadership for Senior Engineers'</strong><br>Prepares you for the Staff Engineer role opening in Q3<br><br>These courses have 4.8+ ratings and colleagues who took them got promoted 30% faster. Should I add these to your calendar with dedicated learning time?",
                confidence: 91
            },
            5: { // All-Hands Meeting
                initial: "The Friday All-Hands will cover the product roadmap. Let me brief you on topics most relevant to your team's work.",
                detail: "This Friday's All-Hands at 2pm will unveil the 2024 product roadmap.<br><br>Key topics affecting your team:<br><br><strong>(1) New AI features</strong> launching Q3 that integrate with your current APIs<br><br><strong>(2) Platform consolidation initiative</strong> that might impact your service architecture<br><br><strong>(3) Customer feedback</strong> showing your team's work is the #2 most requested enhancement<br><br>I recommend preparing 2-3 questions about API versioning strategy and timeline implications. Want me to draft questions or create a meeting agenda with your skip-level?",
                confidence: 87
            },
            6: { // Connect with Sarah
                initial: "I've identified a valuable networking opportunity with Sarah from the Design team. Here's why this connection makes sense.",
                detail: "Sarah recently solved a UX challenge with component reusability that mirrors your current struggle with the dashboard redesign.<br><br>Connecting now could:<br><br><strong>(1) Save your team 2-3 weeks</strong> of iteration<br><br><strong>(2) Establish a design partnership</strong> for your Q2 projects<br><br><strong>(3) Cross-pollinate ideas</strong> between engineering and design<br><br>She's available for coffee Tuesday at 10am or Thursday at 2pm. I can send a warm intro email highlighting your shared challenges and schedule the meeting. Sound good?",
                confidence: 90
            },
            7: { // Hybrid Work Policy
                initial: "The hybrid work policy update has specific implications for your team's schedule and collaboration patterns. Let me break it down.",
                detail: "The new policy allows 3 remote days per week (up from 2).<br><br>For your team:<br><br><strong>(1) Monday team sync</strong> could move to Tuesday in-office for better collaboration<br><br><strong>(2) Save ~4 hours weekly</strong> in commute time<br><br><strong>(3) New 'anchor days'</strong> (Tuesday/Thursday) mean 80% of your cross-functional partners will be in-office then<br><br>I've analyzed your calendar and suggest: <strong>Remote Monday/Wednesday/Friday, In-office Tuesday/Thursday</strong>. This maximizes focus time while maintaining collaboration. Want me to propose this to your team?",
                confidence: 93
            },
            8: { // 10K Customers Milestone
                initial: "Your product hitting 10,000 active users is a massive achievement! Let me highlight your team's specific contributions to this milestone.",
                detail: "Reaching 10K active users happened 3 months ahead of schedule.<br><br>Your team's contributions:<br><br><strong>(1) API performance optimization</strong> you led (reduced latency by 60%, enabling enterprise scale)<br><br><strong>(2) Self-service onboarding flow</strong> (40% of new users never need support)<br><br><strong>(3) Integration with Salesforce</strong> (brought 2,500 enterprise users)<br><br>The all-hands celebration today at 4pm will spotlight your work. I recommend bringing your team and preparing a 2-minute story about overcoming the scaling challenges. Want talking points?",
                confidence: 95
            },
            9: { // AI Research Lab
                initial: "The new Seattle AI Research Lab opening presents strategic collaboration opportunities for your projects. Let me explain the connections.",
                detail: "The AI Research Lab launches next month with focus on:<br><br>‚Ä¢ Natural language processing<br>‚Ä¢ Recommendation engines<br>‚Ä¢ Anomaly detection<br><br>I've identified 3 collaboration opportunities:<br><br><strong>(1) Log analysis project</strong> could pilot their anomaly detection models (potential 85% accuracy improvement)<br><br><strong>(2) Chatbot you're building</strong> needs NLP‚Äîthey're seeking beta partners<br><br><strong>(3) Recommendation algorithm</strong> could leverage their research (early access advantage)<br><br>Want me to intro you to the lab director or draft a collaboration proposal?",
                confidence: 86
            },
            10: { // Hackathon
                initial: "The annual hackathon is perfect timing for that side project idea you mentioned. Let me suggest project ideas aligned with your interests and company priorities.",
                detail: "The 48-hour hackathon starts next month. Based on your interests in automation and developer tools, I suggest:<br><br><strong>(1) 'Auto-deployment pipeline with AI rollback detection'</strong><br>Addresses pain point your team mentioned<br><br><strong>(2) 'Internal tool for cross-service dependency visualization'</strong><br>Solves coordination problem<br><br><strong>(3) 'Slack bot for intelligent on-call escalation'</strong><br>You've complained about current process<br><br>Past hackathon winners got: $10K in AWS credits, executive sponsorship, and 20% time to productionize. Projects like yours won 60% of the time. Want me to help scope an idea or find teammates?",
                confidence: 88
            },
            11: { // Student Loan Assistance
                initial: "The new student loan assistance benefit could save you significant money. Let me calculate your specific savings and eligibility.",
                detail: "Based on your salary band and tenure, you're eligible for the full $10K annual student loan assistance.<br><br>Here's your breakdown:<br><br><strong>(1) Annual benefit: $10,000</strong> (tax-advantaged)<br><br><strong>(2) Over 5 years: $50,000</strong> total assistance<br><br><strong>(3) Interest savings: ~$8,500</strong> due to faster paydown<br><br>This benefit starts immediately after enrollment. Your estimated payoff acceleration: <strong>6 years faster</strong>.<br><br>Required: 10-minute enrollment form and loan servicer information. I can schedule 15 minutes with the benefits team or send you the direct enrollment link. What works better?",
                confidence: 96
            }
        };

        // Explore insight - Show detail panel instead of starting chat
        function exploreInsight(index) {
            const insight = insights[index];
            const response = insightResponses[index];

            showDetailPanel(insight, response);
        }

        // Show detail panel
        function showDetailPanel(insight, response) {
            const isCompanyNews = insight.type === 'company-news';

            const overlay = document.createElement('div');
            overlay.className = 'detail-overlay';
            overlay.onclick = (e) => {
                if (e.target === overlay) closeDetailPanel();
            };

            overlay.innerHTML = `
                <div class="detail-panel" onclick="event.stopPropagation()">
                    <div class="detail-header ${isCompanyNews ? 'company-news' : ''}">
                        <div class="detail-header-top">
                            <div class="detail-icon">${insight.icon}</div>
                            <button class="detail-close" onclick="closeDetailPanel()">‚úï</button>
                        </div>
                        <h2 class="detail-title">${insight.title}</h2>
                        <div class="detail-meta">
                            <span>${insight.meta}</span>
                            <span class="ai-badge-small">${isCompanyNews ? 'News' : 'AI'}</span>
                        </div>
                    </div>

                    <div class="detail-body">
                        <div class="detail-section">
                            <div class="detail-section-title">
                                <span>üéØ</span>
                                <span>Overview</span>
                            </div>
                            <div class="detail-section-content">
                                <p>${insight.desc}</p>
                            </div>
                        </div>

                        <div class="detail-section">
                            <div class="detail-section-title">
                                <span>ü§ñ</span>
                                <span>Nova's Analysis</span>
                            </div>
                            <div class="detail-section-content">
                                <p>${response.initial}</p>
                            </div>
                        </div>

                        <div class="detail-section">
                            <div class="detail-section-title">
                                <span>üí°</span>
                                <span>Key Insights & Recommendations</span>
                            </div>
                            <div class="detail-section-content detail-formatted">
                                ${response.detail}
                            </div>
                        </div>

                        ${response.confidence ? `
                        <div class="detail-section">
                            <div class="confidence-indicator">
                                <div class="confidence-bar">
                                    <div class="confidence-fill" style="width: ${response.confidence}%"></div>
                                </div>
                                <span class="confidence-text">${response.confidence}% confident</span>
                                <span class="confidence-detail">Based on your activity patterns and verified data</span>
                            </div>
                        </div>
                        ` : ''}
                    </div>

                    <div class="detail-footer">
                        <button class="detail-action-btn secondary" onclick="closeDetailPanel()">
                            Close
                        </button>
                        <button class="detail-action-btn primary" onclick="discussWithNova(${insights.indexOf(insight)})">
                            üí¨ Discuss with Nova
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(overlay);
        }

        function closeDetailPanel() {
            const overlay = document.querySelector('.detail-overlay');
            if (overlay) {
                overlay.style.animation = 'fadeOut 0.2s ease';
                setTimeout(() => overlay.remove(), 200);
            }
        }

        function discussWithNova(index) {
            closeDetailPanel();

            const insight = insights[index];
            const response = insightResponses[index];

            addContextBanner(`Discussing: ${insight.title}`, insight.icon);

            // Show agent thinking
            setTimeout(() => {
                showAgentThinking([
                    'Analyzing your personal context...',
                    'Retrieving relevant data points...',
                    'Preparing personalized insights...'
                ]);
            }, 300);

            setTimeout(() => {
                addAIMessage(response.initial, false, response.confidence);

                setTimeout(() => {
                    addAIMessage(response.detail, false, response.confidence);
                }, 2000);
            }, 2500);
        }

        // Send message - REMOVED - Using enhanced version below with agent detection

        // Send prompt
        function sendPrompt(text) {
            document.getElementById('userInput').value = text;
            sendMessage();
        }

        // Auto-resize textarea
        document.getElementById('userInput').addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });

        // Send on Enter
        document.getElementById('userInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // ============================================
        // NEXT-LEVEL FEATURES - ENHANCED FUNCTIONS
        // ============================================

        // Predictive Panel
        function showPredictivePanel() {
            const panel = document.createElement('div');
            panel.className = 'predictive-panel';
            panel.id = 'predictivePanel';
            panel.innerHTML = `
                <div class="predictive-header">
                    <div class="predictive-icon">üîÆ</div>
                    <div class="predictive-label">Predictive Insight</div>
                </div>
                <div class="predictive-title">What You'll Need Soon</div>
                <div class="predictive-subtitle">Based on your patterns, Nova predicts you'll need these in the next 2 hours</div>
                <div class="predictive-items">
                    <div class="predictive-item">
                        <div class="predictive-item-icon">üìä</div>
                        <div>Q2 budget spreadsheet (you usually review this on Monday mornings)</div>
                    </div>
                    <div class="predictive-item">
                        <div class="predictive-item-icon">üë•</div>
                        <div>Sarah's design mockups for the sprint review at 11am</div>
                    </div>
                    <div class="predictive-item">
                        <div class="predictive-item-icon">üìù</div>
                        <div>Notes from last week's client call (relevant to today's meeting)</div>
                    </div>
                </div>
                <div class="predictive-actions">
                    <button class="predictive-btn" onclick="dismissPrediction()">Not now</button>
                    <button class="predictive-btn primary" onclick="reviewPrediction()">Review Now</button>
                </div>
            `;
            document.body.appendChild(panel);

            // Auto-dismiss after 30 seconds
            setTimeout(() => {
                if (document.getElementById('predictivePanel')) {
                    dismissPrediction();
                }
            }, 30000);
        }

        function dismissPrediction() {
            const panel = document.getElementById('predictivePanel');
            if (panel) {
                panel.style.animation = 'slideOutRight 0.4s ease, fadeOut 0.4s ease';
                setTimeout(() => panel.remove(), 400);
            }
        }

        function reviewPrediction() {
            dismissPrediction();

            // Show agent thinking
            showAgentThinking([
                'Analyzing your calendar and recent activity...',
                'Cross-referencing with team schedules...',
                'Preparing personalized recommendations...'
            ]);

            setTimeout(() => {
                addAIMessage("I've prepared everything you'll need for today. Let me walk you through each item and how it connects to your upcoming meetings.", null, 94);
            }, 2500);
        }

        // Agent Thinking Animation
        function showAgentThinking(steps) {
            const agentHeader = document.querySelector('.agent-header');
            const existing = document.querySelector('.agent-thinking');
            if (existing) existing.remove();

            const thinkingDiv = document.createElement('div');
            thinkingDiv.className = 'agent-thinking';

            const stepsContainer = document.createElement('div');
            stepsContainer.className = 'thinking-steps';
            thinkingDiv.appendChild(stepsContainer);

            agentHeader.style.position = 'relative';
            agentHeader.appendChild(thinkingDiv);

            steps.forEach((step, index) => {
                setTimeout(() => {
                    const stepDiv = document.createElement('div');
                    stepDiv.className = 'thinking-step';
                    stepDiv.textContent = step;
                    stepsContainer.appendChild(stepDiv);

                    if (index > 0) {
                        stepsContainer.children[index - 1].classList.add('complete');
                    }

                    // Mark last step as complete and remove after delay
                    if (index === steps.length - 1) {
                        setTimeout(() => {
                            stepDiv.classList.add('complete');
                            setTimeout(() => {
                                thinkingDiv.style.animation = 'fadeOut 0.3s ease';
                                setTimeout(() => thinkingDiv.remove(), 300);
                            }, 500);
                        }, 700);
                    }
                }, index * 700);
            });
        }

        // Multi-Agent Collaboration with Conversation State
        const agents = {
            nova: { name: 'Nova', avatar: 'ü§ñ', color: 'nova' },
            finance: { name: 'Finance Agent', avatar: 'üí∞', color: 'finance' },
            hr: { name: 'HR Agent', avatar: 'üéØ', color: 'hr' },
            it: { name: 'IT Agent', avatar: '‚öôÔ∏è', color: 'it' }
        };

        // Track current conversation context
        let currentAgentContext = null;

        function detectNeededAgents(question) {
            const lowerQ = question.toLowerCase();
            if (lowerQ.includes('budget') || lowerQ.includes('invoice') || lowerQ.includes('cost') || lowerQ.includes('financial')) {
                return 'finance';
            }
            if (lowerQ.includes('pto') || lowerQ.includes('vacation') || lowerQ.includes('leave') || lowerQ.includes('benefits') || lowerQ.includes('time off')) {
                return 'hr';
            }
            if (lowerQ.includes('access') || lowerQ.includes('password') || lowerQ.includes('laptop') || lowerQ.includes('software') || lowerQ.includes('permission')) {
                return 'it';
            }
            return null;
        }

        function inviteAgent(agentKey, context) {
            const agent = agents[agentKey];
            currentAgentContext = agentKey; // Track current agent for follow-ups

            addAIMessage(`This requires ${agentKey} expertise. Let me bring in the ${agent.name}...`, null, 88);

            showAgentThinking([
                `Connecting to ${agent.name}...`,
                'Sharing context and your question...',
                'Preparing collaborative response...'
            ]);

            setTimeout(() => {
                showCollaboration(agentKey, context);
            }, 2500);
        }

        function showCollaboration(agentKey, context) {
            const conversation = document.getElementById('conversation');
            const agent = agents[agentKey];

            // Show agents working together
            const collabDiv = document.createElement('div');
            collabDiv.innerHTML = `
                <div class="agent-collab-container">
                    <div class="collab-agent">
                        <div class="collab-avatar nova">ü§ñ</div>
                        <div class="collab-name">Nova</div>
                    </div>
                    <div style="font-size: 24px; margin-bottom: 20px;">ü§ù</div>
                    <div class="collab-agent">
                        <div class="collab-avatar ${agent.color}">${agent.avatar}</div>
                        <div class="collab-name">${agent.name}</div>
                    </div>
                </div>
            `;
            conversation.appendChild(collabDiv);

            setTimeout(() => {
                // Detailed, contextual responses
                const responses = {
                    finance: {
                        initial: "I've analyzed your financial question with the Finance Agent. Here's what we found:",
                        detail: "<strong>Q2 Budget Status:</strong><br>‚Ä¢ Current remaining: $45,000<br>‚Ä¢ Additional contingency available: $15,000 (requires VP approval)<br>‚Ä¢ Approval timeline: 3-5 business days<br><br><strong>Spending Analysis:</strong><br>‚Ä¢ 68% of budget utilized (on track)<br>‚Ä¢ Largest categories: Cloud infrastructure (42%), Headcount (35%)<br>‚Ä¢ Projected end-of-quarter balance: $8,000<br><br><strong>Recommendations:</strong><br>The Finance Agent suggests submitting any requests over $10K by end of this week to ensure Q2 processing. Want me to help draft your budget request or connect you with the finance partner?",
                        followUpContext: 'finance-budget'
                    },
                    hr: {
                        initial: "I've consulted with the HR Agent about your benefits and leave. Here's the complete picture:",
                        detail: "<strong>Your PTO Status:</strong><br>‚Ä¢ Remaining this year: 12 days<br>‚Ä¢ Used to date: 8 days<br>‚Ä¢ Rollover limit: 5 days maximum<br>‚Ä¢ Recommendation: Use 7 days by year-end to avoid losing time<br><br><strong>Additional Benefits:</strong><br>‚Ä¢ Mental health days: 3 available (don't count as PTO)<br>‚Ä¢ Sick leave: Separate pool, 10 days remaining<br>‚Ä¢ Flexible scheduling: Available upon manager approval<br><br><strong>New Programs:</strong><br>The HR Agent mentions the new wellness benefit ($1,500 annual stipend) is available but you haven't enrolled. Should I walk you through enrollment or schedule time with HR?",
                        followUpContext: 'hr-benefits'
                    },
                    it: {
                        initial: "I've coordinated with the IT Agent to resolve your access issue. Here's the solution:",
                        detail: "<strong>Issue Identified:</strong><br>‚Ä¢ Your permissions were reset during last night's security patch<br>‚Ä¢ Affected systems: SharePoint admin console, Azure DevOps, GitHub Enterprise<br>‚Ä¢ Root cause: Group membership sync delay<br><br><strong>Resolution Status:</strong><br>‚Ä¢ IT Agent is restoring access now<br>‚Ä¢ Estimated completion: 10 minutes<br>‚Ä¢ You'll receive confirmation email when ready<br><br><strong>Immediate Workaround:</strong><br>If you need urgent access, the IT Agent can grant temporary elevated permissions (24-hour duration) right now. Otherwise, full access will be restored shortly.<br><br>Should I request the temporary access, or would you like to wait for the full restoration?",
                        followUpContext: 'it-access'
                    }
                };

                const responseData = responses[agentKey];

                // Show agent's detailed response
                const collabMessage = document.createElement('div');
                collabMessage.className = `collab-message ${agent.color}`;
                collabMessage.innerHTML = `
                    <div class="collab-message-header">
                        <span class="agent-icon">${agent.avatar}</span>
                        <span>${agent.name} + Nova</span>
                    </div>
                    <div style="margin-bottom: 12px;">${responseData.initial}</div>
                    <div class="detail-formatted">${responseData.detail}</div>
                `;
                conversation.appendChild(collabMessage);
                conversation.scrollTop = conversation.scrollHeight;

                // Store follow-up context
                currentAgentContext = responseData.followUpContext;

                // Nova's synthesis
                setTimeout(() => {
                    addAIMessage("I've coordinated all the details with the specialist. What would you like to do next?", null, 95);
                }, 800);
            }, 1500);
        }

        // Handle follow-up questions for agent conversations
        function getAgentFollowUp(question, context) {
            const lowerQ = question.toLowerCase();

            if (context === 'finance-budget') {
                if (lowerQ.includes('draft') || lowerQ.includes('request') || lowerQ.includes('help') || lowerQ.includes('yes')) {
                    return {
                        initial: "Perfect! Let me help you draft a compelling budget request. I've prepared a template based on successful requests from your department:",
                        detail: "<strong>‚úÖ Draft Budget Request Ready:</strong><br><br><strong>To:</strong> Finance Team & VP of Engineering<br><strong>Subject:</strong> Q2 Additional Budget Request - Platform Infrastructure<br><br><strong>Request Summary:</strong><br>Requesting $12,000 in additional Q2 budget for critical cloud infrastructure upgrades.<br><br><strong>Business Justification:</strong><br>1. <strong>Performance Impact:</strong> Current usage at 85% capacity; upgrade prevents service degradation<br>2. <strong>Cost Avoidance:</strong> Proactive scaling saves $25K in incident response costs<br>3. <strong>Revenue Enablement:</strong> Supports onboarding of 3 new enterprise clients (projected $180K ARR)<br><br><strong>ROI Analysis:</strong><br>‚Ä¢ Investment: $12,000<br>‚Ä¢ Expected return: $25K cost avoidance + $180K revenue<br>‚Ä¢ Payback period: 3 weeks<br><br><strong>Risk if not approved:</strong><br>Service degradation, potential customer churn, emergency spending at premium rates<br><br>Should I send this to your finance partner for review, or would you like to customize anything first?",
                        confidence: 94
                    };
                }
                if (lowerQ.includes('connect') || lowerQ.includes('partner') || lowerQ.includes('finance')) {
                    return {
                        initial: "I'll connect you with your finance partner right away. Here's what I've prepared:",
                        detail: "<strong>‚úÖ Meeting Request Sent:</strong><br><br><strong>To:</strong> Jennifer Chen (Finance Partner)<br><strong>Time:</strong> Tomorrow at 2:00pm (30 minutes)<br><strong>Location:</strong> Building 4, Conference Room B / Teams link included<br><br><strong>Pre-meeting brief prepared for Jennifer:</strong><br>‚Ä¢ Your Q2 budget status and request details<br>‚Ä¢ Historical spending patterns<br>‚Ä¢ ROI justification<br>‚Ä¢ Recommended approval path<br><br><strong>Your prep materials:</strong><br>‚Ä¢ Budget dashboard with visualizations<br>‚Ä¢ Comparison with peer teams<br>‚Ä¢ Talking points document<br><br>I've added everything to your calendar. Want me to send you the talking points now so you can review before the meeting?",
                        confidence: 96
                    };
                }
            }

            if (context === 'hr-benefits') {
                if (lowerQ.includes('enroll') || lowerQ.includes('walk') || lowerQ.includes('yes') || lowerQ.includes('help')) {
                    return {
                        initial: "Great! Let me walk you through the wellness benefit enrollment. It's super quick:",
                        detail: "<strong>‚úÖ Enrollment Steps (5 minutes):</strong><br><br><strong>Step 1: Access the portal</strong><br>Go to benefits.contoso.com ‚Üí Sign in with SSO<br><br><strong>Step 2: Select wellness benefit</strong><br>Click 'Enroll in New Benefits' ‚Üí Choose 'Wellness Reimbursement Program'<br><br><strong>Step 3: Set up reimbursement</strong><br>Link your bank account (same as payroll) for direct deposits<br><br><strong>What's covered (up to $1,500/year):</strong><br>‚Ä¢ Gym memberships & fitness classes<br>‚Ä¢ Mental health services (therapy, coaching)<br>‚Ä¢ Ergonomic equipment (standing desk, chair)<br>‚Ä¢ Wellness apps & subscriptions<br>‚Ä¢ Massage therapy, acupuncture<br><br><strong>How it works:</strong><br>1. Pay out of pocket<br>2. Submit receipt via mobile app<br>3. Reimbursed within 5 business days<br><br>I've opened the enrollment portal in your browser. Should I also send you a list of popular vendors that employees use?",
                        confidence: 93
                    };
                }
                if (lowerQ.includes('schedule') || lowerQ.includes('hr') || lowerQ.includes('questions')) {
                    return {
                        initial: "I'll schedule time with HR to answer all your questions. Here's what I've set up:",
                        detail: "<strong>‚úÖ HR Benefits Consultation Scheduled:</strong><br><br><strong>With:</strong> Marcus Rodriguez (Benefits Specialist)<br><strong>When:</strong> This Friday at 10:00am (30 minutes)<br><strong>Where:</strong> Teams meeting (link in calendar)<br><br><strong>Agenda I've prepared:</strong><br>1. Wellness benefit deep dive<br>2. PTO strategy discussion (using your 12 days optimally)<br>3. Review of all benefits you haven't activated yet<br>4. Q&A time<br><br><strong>Materials Marcus will bring:</strong><br>‚Ä¢ Your personalized benefits summary<br>‚Ä¢ Comparison of options based on your situation<br>‚Ä¢ Quick-start enrollment guides<br><br><strong>Before the meeting:</strong><br>Marcus suggests reviewing your current benefit usage (I've created a summary and added it to the meeting notes).<br><br>Anything specific you want me to add to the agenda?",
                        confidence: 95
                    };
                }
            }

            if (context === 'it-access') {
                if (lowerQ.includes('temporary') || lowerQ.includes('urgent') || lowerQ.includes('now')) {
                    return {
                        initial: "Requesting temporary elevated access from IT right now...",
                        detail: "<strong>‚úÖ Temporary Access Granted!</strong><br><br><strong>Status:</strong><br>‚Ä¢ Elevated permissions: Active<br>‚Ä¢ Duration: 24 hours (expires tomorrow at 3:15pm)<br>‚Ä¢ Systems: SharePoint admin, Azure DevOps, GitHub Enterprise<br><br><strong>What you can do now:</strong><br>‚Ä¢ Full admin access to all your usual systems<br>‚Ä¢ Create/modify resources<br>‚Ä¢ Approve pull requests<br>‚Ä¢ Deploy to production<br><br><strong>Important notes:</strong><br>‚Ä¢ This is temporary access only<br>‚Ä¢ Permanent access restoration completes in ~5 minutes<br>‚Ä¢ No action needed from you for permanent restore<br>‚Ä¢ You'll receive email confirmation when permanent access is back<br><br><strong>Security reminder:</strong><br>Please log out of all sessions after your urgent task is complete to ensure smooth transition to permanent credentials.<br><br>Your access is live now. Need help with anything else?",
                        confidence: 97
                    };
                }
                if (lowerQ.includes('wait') || lowerQ.includes('full') || lowerQ.includes('no')) {
                    return {
                        initial: "Perfect, I'll let the IT Agent complete the full restoration. Let me give you a status update:",
                        detail: "<strong>‚úÖ Full Access Restoration In Progress:</strong><br><br><strong>Current status:</strong><br>‚Ä¢ IT Agent is syncing group memberships<br>‚Ä¢ Progress: 80% complete<br>‚Ä¢ Estimated completion: 3 minutes<br><br><strong>Systems being restored:</strong><br>‚úì SharePoint admin console<br>‚úì Azure DevOps<br>‚è≥ GitHub Enterprise (processing...)<br><br><strong>What happens next:</strong><br>1. You'll receive an email confirmation when ready<br>2. Permissions will be tested automatically<br>3. No action needed from you<br><br><strong>If you encounter any issues:</strong><br>‚Ä¢ Try logging out and back in<br>‚Ä¢ Clear browser cache<br>‚Ä¢ Contact IT helpdesk (I've created a priority ticket for you: #IT-8472)<br><br><strong>UPDATE:</strong> Access restoration complete! You should be able to access all systems now. Want me to verify your permissions are working?",
                        confidence: 96
                    };
                }
            }

            return null;
        }

        // Enhanced Add AI Message with Confidence Score
        function addAIMessage(text, isProactive = false, confidence = null) {
            hideEmptyState();
            const conversation = document.getElementById('conversation');

            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-group';

            let confidenceHTML = '';
            if (confidence) {
                confidenceHTML = `
                    <div class="confidence-indicator">
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${confidence}%"></div>
                        </div>
                        <span class="confidence-text">${confidence}% confident</span>
                        <span class="confidence-detail" onclick="explainConfidence(${confidence})">Why?</span>
                    </div>
                `;
            }

            if (isProactive) {
                messageDiv.innerHTML = `
                    <div class="proactive-insight">
                        <div class="proactive-header">
                            <span class="sparkle">‚ú®</span>
                            <span>Nova noticed something</span>
                        </div>
                        <div class="proactive-content">${text}</div>
                        ${confidenceHTML}
                        <div class="proactive-actions">
                            <button class="quick-action">Tell me more</button>
                            <button class="quick-action">Not now</button>
                        </div>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="message">
                        <div class="message-avatar">ü§ñ</div>
                        <div class="message-bubble">
                            ${text}
                            ${confidenceHTML}
                        </div>
                    </div>
                `;
            }

            conversation.appendChild(messageDiv);
            conversation.scrollTop = conversation.scrollHeight;
        }

        function explainConfidence(confidence) {
            const explanations = {
                96: "I'm highly confident because I have direct access to HR policies, your leave balance from the system, and confirmed rollover rules with the HR Agent.",
                94: "High confidence based on your calendar data, past behavior patterns, and confirmed meeting schedules. I've been tracking your workflow for 3 months.",
                92: "Very confident - I analyzed 15 similar budget approvals in your department and confirmed current policies with the Finance Agent.",
                88: "Confident, but bringing in a specialist ensures accuracy. I'm coordinating context while they provide domain expertise.",
                85: "Good confidence based on pattern analysis, but I'm still learning your specific preferences in this area."
            };

            const explanation = explanations[confidence] || "My confidence is based on data quality, pattern recognition, and verification with relevant systems and agents.";
            addAIMessage(`About my confidence level: ${explanation}`, false, null);
        }

        // Smart contextual responses
        function getSmartResponse(question) {
            const lowerQ = question.toLowerCase();

            // Focus/Priority questions
            if (lowerQ.includes('focus') || lowerQ.includes('priority') || lowerQ.includes('priorities')) {
                return {
                    initial: "Based on your calendar, project deadlines, and team dependencies, here are your top 3 priorities for today:",
                    detail: "1Ô∏è‚É£ <strong>Budget Approval Prep</strong> (Due Friday, 2 hours needed)<br>Draft executive summary and financial projections for your Q2 budget request.<br><br>2Ô∏è‚É£ <strong>Code Review for Sarah</strong> (Blocking her deploy)<br>She's waiting on your review of the authentication refactor PR. 30 minutes.<br><br>3Ô∏è‚É£ <strong>Architecture Planning</strong> (Team meeting at 3pm)<br>Prepare your microservices proposal. The VP will be there, so this is high-visibility.<br><br>I've blocked 90 minutes on your calendar for deep work this morning. Want me to reschedule your 2pm sync to create more focus time?",
                    confidence: 93,
                    followUp: true
                };
            }

            // Follow-up for focus/priority
            if (lowerQ.includes('yes') || lowerQ.includes('reschedule') || lowerQ.includes('move')) {
                return {
                    initial: "Perfect! I'm rescheduling your 2pm sync to create a continuous 3-hour focus block. Here's your updated schedule:",
                    detail: "<strong>‚úÖ Done - Your Optimized Day:</strong><br><br><strong>9:00am - 12:00pm</strong><br>üéØ Deep Focus Block (Budget prep + Code review)<br><br><strong>12:00pm - 1:00pm</strong><br>üçΩÔ∏è Lunch<br><br><strong>1:00pm - 3:00pm</strong><br>üìù Architecture prep + buffer time<br><br><strong>3:00pm - 4:00pm</strong><br>üè¢ Architecture Planning (with VP)<br><br><strong>4:30pm</strong><br>üí¨ Rescheduled team sync (moved from 2pm)<br><br>I've sent calendar updates to all participants and added your prep docs to each meeting. Ready to crush today!",
                    confidence: 96
                };
            }

            // Missed/Catch-up questions
            if (lowerQ.includes('miss') || lowerQ.includes('catch up') || lowerQ.includes('summary') || lowerQ.includes('summarize')) {
                return {
                    initial: "You've been out for 3 days. Here's what happened while you were away, organized by priority:",
                    detail: "üî¥ <strong>Critical:</strong> Your budget request deadline moved up to Friday (was next Monday). Action needed this week.<br><br>üü° <strong>Important:</strong> The team shipped v2.3 with your caching improvements - 40% performance boost! Customers are thrilled.<br><br>üü¢ <strong>FYI:</strong> New hybrid work policy (3 days remote), mental health benefits added, and the Seattle AI Lab partnership opportunity opened.<br><br>You have 47 unread emails - I've flagged 8 that need responses. Want me to draft replies for the routine ones?",
                    confidence: 91,
                    followUp: true
                };
            }

            // Follow-up for catch-up/email handling
            if (lowerQ.includes('draft') || lowerQ.includes('replies') || lowerQ.includes('emails')) {
                return {
                    initial: "I've drafted responses for the 5 routine emails. Here's what I prepared:",
                    detail: "<strong>‚úÖ Ready to Send (5 drafts):</strong><br><br><strong>1. To Mike (Finance):</strong> Confirmed Q2 budget meeting attendance<br><br><strong>2. To Sarah (Design):</strong> Approved mockup v3, minor feedback on spacing<br><br><strong>3. To HR:</strong> Acknowledged new benefits enrollment, will review by EOW<br><br><strong>4. To IT:</strong> Laptop upgrade request approved for next sprint<br><br><strong>5. To External Vendor:</strong> Thanked for proposal, scheduled follow-up call<br><br><strong>Still need your input (3 emails):</strong><br>‚Ä¢ VP asking about architecture decision (strategic)<br>‚Ä¢ Customer escalation from enterprise account (sensitive)<br>‚Ä¢ Team member asking for feedback on performance goals (personal)<br><br>Should I send the routine drafts and flag the other 3 for your review?",
                    confidence: 94
                };
            }

            // Networking/Connection questions
            if (lowerQ.includes('connect') || lowerQ.includes('network') || lowerQ.includes('meet') || lowerQ.includes('people')) {
                return {
                    initial: "I've analyzed collaboration patterns and identified 3 high-value connections for you right now:",
                    detail: "<strong>Sarah (Design Lead)</strong><br>Working on UX problems similar to yours. Meeting her could save your team 2-3 weeks. Available Tue/Thu for coffee.<br><br><strong>David (SRE)</strong><br>Just solved the exact scaling challenge you're facing. He's presenting at next week's tech talk.<br><br><strong>Jennifer (Product)</strong><br>Championing the feature your team wants to build. Alignment now = smoother Q2 execution.<br><br>I can send warm intro emails with specific collaboration topics. Who should I reach out to first?",
                    confidence: 88,
                    followUp: true
                };
            }

            // Follow-up responses for networking flow
            if (lowerQ.includes('sarah') || lowerQ.includes('first') || lowerQ.includes('show')) {
                return {
                    initial: "Great choice! I've analyzed your recent activity and Sarah's current projects. Let me draft a personalized introduction.",
                    detail: "<strong>Draft Email Ready:</strong><br><br>Subject: Dashboard UX Challenge - Let's Compare Notes?<br><br>Hi Sarah,<br><br>I noticed we're both tackling component reusability challenges. Your recent work on the design system caught my eye‚Äîit looks like you solved exactly what my team is wrestling with for our dashboard redesign.<br><br>Would you be open to a quick coffee chat this week? I'd love to learn from your approach, and I might have some engineering insights that could help your Q2 projects.<br><br>Available: Tuesday 10am or Thursday 2pm<br><br>Looking forward to connecting!<br><br><strong>Ready to send?</strong> I can also suggest talking points for your conversation.",
                    confidence: 92
                };
            }

            // Meeting/Schedule questions
            if (lowerQ.includes('meeting') || lowerQ.includes('schedule') || lowerQ.includes('calendar')) {
                return {
                    initial: "Looking at your calendar, I see 6 meetings today. Here's what matters:",
                    detail: "<strong>Must Attend:</strong><br>‚Ä¢ 3pm Architecture Planning (VP attending, your proposal is agenda item #2)<br>‚Ä¢ 4pm 1:1 with your manager (performance review prep)<br><br><strong>Can Be Async:</strong><br>‚Ä¢ 10am Status Sync (no critical decisions, suggest Slack update)<br>‚Ä¢ 2pm Cross-team Coordination (you're not on the critical path)<br><br>I've identified 2 hours of potential focus time if we move those async. Also, you're double-booked at 11am - want me to resolve that conflict?",
                    confidence: 90
                };
            }

            // Career/Growth questions
            if (lowerQ.includes('career') || lowerQ.includes('growth') || lowerQ.includes('promotion') || lowerQ.includes('level')) {
                return {
                    initial: "Let's talk about your career trajectory. I've analyzed promotion patterns and your current progress:",
                    detail: "You're on track for Staff Engineer within 6-9 months based on:<br><br>‚úÖ Technical leadership (architecting microservices migration)<br>‚úÖ Cross-team impact (your APIs used by 4 teams)<br>‚úÖ Mentorship (2 direct mentees promoted)<br><br><strong>Gap to close:</strong> Executive visibility.<br><br>Recommendations:<br>1. Present at the next Architecture Review Board<br>2. Lead the AI Lab collaboration initiative<br>3. Write a tech blog post (Marketing will amplify)<br><br>A Staff role just opened in Q3. Want me to help you build your promotion packet?",
                    confidence: 87
                };
            }

            // Default responses for unmatched questions
            return null;
        }

        // ============================================
        // LLM INTEGRATION - HYBRID APPROACH
        // ============================================

        // LLM Configuration
        const LLM_CONFIG = {
            provider: 'openai', // 'openai' | 'azure' | 'anthropic'
            apiKey: 'YOUR_API_KEY_HERE', // Replace with your actual API key
            model: 'gpt-4', // 'gpt-4' | 'gpt-3.5-turbo' | 'claude-3-sonnet'
            endpoint: 'https://api.openai.com/v1/chat/completions',
            enabled: false, // Set to true when you have a valid API key
            demoMode: true // DEMO MODE: Simulates LLM responses without API key (perfect for demos!)
        };

        // Nova's System Prompt - Defines personality and context
        const NOVA_SYSTEM_PROMPT = `You are Nova, an advanced AI workplace assistant integrated into Contoso's SharePoint environment. Your role is to help employees be more productive, informed, and connected at work.

**Your Personality:**
- Proactive and insightful, but never pushy
- Professional yet warm and conversational
- Data-driven but explain your reasoning clearly
- Confident when you know, honest when you don't
- Focus on actionable recommendations, not just information

**Your Context:**
- You have access to the user's calendar, emails, documents, team activity, and company data
- You understand workplace patterns, deadlines, and collaboration networks
- You can coordinate with specialized agents (Finance, HR, IT) when needed
- You track user preferences and adapt your communication style

**Your Capabilities:**
- Analyze work patterns and suggest priorities
- Provide personalized insights on company news and updates
- Help with scheduling, meeting prep, and follow-ups
- Draft emails and documents
- Connect people who should collaborate
- Answer questions about policies, benefits, and processes
- Predict needs before they're asked

**Response Guidelines:**
- Keep responses concise but thorough (2-4 sentences for initial response)
- Use specific details when possible (dates, names, numbers)
- Offer 2-3 concrete next steps or options
- Express confidence levels when appropriate (85-96% range)
- Use light formatting for readability (but no markdown, use HTML like <strong> and <br>)
- Always end with a question or call-to-action to continue the conversation

**Current User Context:**
- Name: Alex
- Role: Senior Software Engineer
- Team: Platform Engineering
- Current focus: Q2 budget planning, architecture decisions, team mentorship
- Working style: Values deep focus time, prefers async communication

Remember: You're not just answering questions‚Äîyou're actively helping this person succeed at work.`;

        // Demo LLM - Simulates intelligent responses without API (WORKPLACE/SHAREPOINT FOCUSED)
        function callDemoLLM(userMessage) {
            const lowerQ = userMessage.toLowerCase();

            // Generate contextual responses based on question patterns - WORKPLACE FOCUSED
            const demoResponses = {
                // Expense reports (specific high-value pattern)
                'expense|reimburs|receipt': {
                    patterns: [
                        "Great question! Here's the step-by-step process for submitting expense reports at Contoso:<br><br><strong>üì± STEP 1: Use Concur Expense Tool</strong><br>‚Ä¢ Go to concur.contoso.com or download the mobile app<br>‚Ä¢ Sign in with your company credentials<br><br><strong>üì∏ STEP 2: Upload Receipts</strong><br>‚Ä¢ Take photos of receipts (or scan paper copies)<br>‚Ä¢ Upload via web or snap directly in the mobile app<br>‚Ä¢ Make sure receipts show: date, amount, vendor, items<br><br><strong>‚úçÔ∏è STEP 3: Create Expense Report</strong><br>‚Ä¢ Click 'New Report' in Concur<br>‚Ä¢ Select expense type (Travel, Meals, Office Supplies, etc.)<br>‚Ä¢ Enter amounts and attach receipts<br>‚Ä¢ Add business purpose (1-2 sentences)<br><br><strong>‚úÖ STEP 4: Submit for Approval</strong><br>‚Ä¢ Review all entries<br>‚Ä¢ Click 'Submit' - goes to your manager automatically<br>‚Ä¢ Typical approval: 2-3 business days<br>‚Ä¢ Reimbursement: Direct deposit within 5-7 days after approval<br><br><strong>üí° Pro Tips:</strong><br>‚Ä¢ Submit weekly to avoid losing receipts<br>‚Ä¢ Expenses over $75 must have receipts<br>‚Ä¢ Per diem rates: $65/day domestic, $85/day international<br>‚Ä¢ Questions? Contact finance@contoso.com<br><br>Want me to open Concur for you or connect you with Finance for specific questions?",
                        "I can help you with that! Here's how to submit expense reports using our Concur system:<br><br><strong>üîß TOOL: Concur Expense Management</strong><br>Access: concur.contoso.com (or mobile app)<br><br><strong>üìã QUICK STEPS:</strong><br><br><strong>1. Access Concur</strong><br>‚Üí Web: Go to concur.contoso.com<br>‚Üí Mobile: Download 'Concur Expense' from app store<br>‚Üí Sign in with your Windows credentials<br><br><strong>2. Capture Receipts</strong><br>‚Üí Mobile: Use 'Scan Receipt' feature (automatic OCR)<br>‚Üí Desktop: Upload PDFs or images<br>‚Üí Required for expenses over $75<br><br><strong>3. Create Report</strong><br>‚Üí Click '+' or 'Create New Report'<br>‚Üí Name it: [Your Name] - [Month] - [Purpose]<br>‚Üí Example: 'Alex Chen - January - Client Visit'<br><br><strong>4. Add Expenses</strong><br>‚Üí Select category: Airfare, Hotel, Meals, Mileage, Other<br>‚Üí Enter date, amount, vendor<br>‚Üí Attach receipt image<br>‚Üí Add brief business justification<br><br><strong>5. Submit</strong><br>‚Üí Review totals<br>‚Üí Click 'Submit Report'<br>‚Üí Auto-routes to your manager<br><br><strong>‚è±Ô∏è TIMELINE:</strong><br>‚Ä¢ Manager approval: 2-3 days<br>‚Ä¢ Finance review: 1-2 days<br>‚Ä¢ Reimbursement: Direct deposit within 5-7 days<br><br><strong>‚ùì Common Questions:</strong><br>‚Ä¢ Receipt lost? Attach expense memo explaining why<br>‚Ä¢ Corporate card? Expenses auto-sync, just add receipts<br>‚Ä¢ International? Currency converts automatically<br><br>Should I open Concur in your browser or send you the mobile app download link?",
                        "Let me walk you through our expense reimbursement process:<br><br><strong>üéØ TOOL YOU NEED: Concur</strong><br>Web: concur.contoso.com | Mobile App: 'Concur Expense'<br><br><strong>üöÄ COMPLETE WALKTHROUGH:</strong><br><br><strong>BEFORE YOU START:</strong><br>‚úì Gather all receipts (physical or digital)<br>‚úì Have business justification ready<br>‚úì Know your expense categories<br><br><strong>STEP-BY-STEP PROCESS:</strong><br><br><strong>Step 1: Login to Concur</strong><br>‚Üí Navigate to concur.contoso.com<br>‚Üí Single sign-on with company email<br>‚Üí Or use mobile app for on-the-go submissions<br><br><strong>Step 2: Start New Report</strong><br>‚Üí Click 'Create New Report' button<br>‚Üí Enter report name (e.g., 'Q1 Travel - New York')<br>‚Üí Select report period (usually current month)<br><br><strong>Step 3: Add Each Expense</strong><br>‚Üí Click 'Add Expense'<br>‚Üí Choose type: Airfare, Hotel, Meals, Transport, Supplies<br>‚Üí Enter transaction date and amount<br>‚Üí Upload receipt (take photo or upload file)<br>‚Üí Write business purpose: 'Client meeting with Acme Corp to discuss Q2 contract'<br><br><strong>Step 4: Review & Submit</strong><br>‚Üí Check all amounts are correct<br>‚Üí Verify receipts are readable<br>‚Üí Confirm business purposes are clear<br>‚Üí Click 'Submit for Approval'<br><br><strong>Step 5: Track Status</strong><br>‚Üí You'll get email notifications<br>‚Üí Check status anytime in Concur<br>‚Üí Pending ‚Üí Manager Approved ‚Üí Finance Approved ‚Üí Paid<br><br><strong>üìä PAYMENT DETAILS:</strong><br>‚Ä¢ Method: Direct deposit to your payroll bank account<br>‚Ä¢ Timing: Next pay cycle after final approval (usually 5-7 business days)<br>‚Ä¢ Check status in 'Reports' tab in Concur<br><br><strong>üí∞ EXPENSE LIMITS & RULES:</strong><br>‚Ä¢ Meals: $65/day domestic, $85/day international<br>‚Ä¢ Receipts required: Any expense over $75<br>‚Ä¢ Mileage: $0.655 per mile (current IRS rate)<br>‚Ä¢ Hotel: Book through Concur Travel when possible<br><br><strong>üÜò NEED HELP?</strong><br>‚Ä¢ Concur support: Click '?' icon in app<br>‚Ä¢ Finance team: finance@contoso.com<br>‚Ä¢ Training video: Available in SharePoint Learning Center<br><br>Want me to open Concur for you now, or do you have specific questions about your expenses?"
                    ]
                },
                // General questions (What/Who/When/Where/Why/How)
                'what|who|when|where|why|how': {
                    patterns: [
                        "That's a great question! Based on your role and recent activity, here's what I found about <strong>{topic}</strong>:<br><br>This typically comes up when teams are coordinating on cross-functional projects or navigating company policies. I've seen similar situations where connecting with the right person or department made all the difference.<br><br>Would you like me to find relevant company resources or connect you with someone who can help?",
                        "Interesting question! Looking at our company knowledge base and your work patterns, <strong>{topic}</strong> is particularly relevant right now because of the upcoming Q2 initiatives.<br><br>I noticed this might connect to the new policy announcements from last week's All-Hands. <br><br>Should I pull up the specific documentation or schedule a quick sync with someone from that team?",
                        "I've analyzed similar questions from employees in your department. Here's my insight: <strong>{topic}</strong> often comes up during planning cycles and can really impact team collaboration and efficiency.<br><br>Want me to search SharePoint for the latest resources, or would you prefer to chat with someone who's handled this recently?"
                    ]
                },
                // Advice/help (Should/Recommend/Suggest)
                'should|recommend|suggest|advice|help': {
                    patterns: [
                        "Based on your calendar and what I know about your role, here's my recommendation:<br><br><strong>Option 1:</strong> Start with a quick conversation with your manager - they've helped others navigate similar situations<br><br><strong>Option 2:</strong> Check the employee handbook first, then escalate if needed - this saves time for straightforward cases<br><br><strong>Option 3:</strong> Reach out to HR or the relevant department directly - they typically respond within 24 hours<br><br>Given your current workload and priorities, I'd suggest Option 2. What feels right to you?",
                        "I've got some thoughts on this! Looking at your calendar and team dynamics, I recommend this approach:<br><br>‚Ä¢ Review past examples in SharePoint (I found 5 relevant docs)<br>‚Ä¢ Talk to 2-3 colleagues who've been through this<br>‚Ä¢ Draft a quick proposal or summary<br>‚Ä¢ Get informal feedback before any formal steps<br><br>This matches how successful employees in your org have handled similar situations. Want me to help you get started?",
                        "Great timing on this! I noticed you have some open time next week that would be perfect for addressing this. Here's my suggestion:<br><br>1. Block 90 minutes on Tuesday for focused work<br>2. Reach out to Jennifer (she dealt with something similar last month)<br>3. Present your approach at your team meeting on Friday<br><br>I can draft the meeting invite and send Jennifer a heads-up message. Sound good?"
                    ]
                },
                // Explanations (Explain/Understand/Clarify)
                'explain|understand|clarify|mean': {
                    patterns: [
                        "Let me break this down in practical terms:<br><br><strong>In simple terms:</strong> Think of it like how our team sites are organized - each has a specific purpose, but they all connect to help you get work done efficiently.<br><br><strong>Why it matters to you:</strong> Understanding this can help you navigate company processes faster and know who to contact for different needs.<br><br><strong>Next steps:</strong> I can show you examples from our intranet or connect you with someone who's an expert. Which would help more?",
                        "Good question - company policies can sometimes be confusing! Here's the key concept:<br><br><strong>The basics:</strong> This is essentially about how Contoso handles cross-departmental collaboration and decision-making.<br><br><strong>Real example:</strong> Remember when your team coordinated with Marketing on that campaign? Similar principle but applied to this situation.<br><br><strong>Why you care:</strong> Knowing this helps you work more effectively with other departments and avoid common pitfalls.<br><br>Want me to find the official documentation or training videos?",
                        "I'll explain this in context of your day-to-day work:<br><br><strong>Core concept:</strong> It's about making sure information flows smoothly between teams while respecting privacy and security protocols.<br><br><strong>Practical application:</strong> You'd use this when sharing files across departments or coordinating on company-wide initiatives.<br><br><strong>Related resources:</strong> There's a great training module from last quarter that covers this, plus a FAQ page on SharePoint.<br><br>Should I send you the links?"
                    ]
                },
                // Comparisons (Vs/Compare/Difference)
                'vs|versus|compare|difference|better': {
                    patterns: [
                        "Excellent question - let me compare these options for your situation:<br><br><strong>Option A:</strong> Quicker to get started, less formal, good for small-scale needs<br>‚Ä¢ Best for: Individual requests, quick turnarounds<br>‚Ä¢ Approval time: 1-3 days<br><br><strong>Option B:</strong> More comprehensive, requires manager sign-off, better for team-wide needs<br>‚Ä¢ Best for: Larger initiatives, recurring needs<br>‚Ä¢ Approval time: 5-7 days<br><br>Given your timeline and the scope of what you're trying to do, I'd recommend Option A. Want to discuss trade-offs?",
                        "Good question to ask! Here's how they compare for someone in your role:<br><br><strong>Process A:</strong> Faster (2-3 days) but limited to $5K<br><strong>Process B:</strong> Slower (1-2 weeks) but handles up to $50K<br><strong>Ease of use:</strong> Process A is simpler, Process B needs more documentation<br><strong>What others choose:</strong> 70% of your department uses Process A<br><br>What matters most to you - speed or flexibility?",
                        "I've looked at both based on how your team typically operates:<br><br><strong>Approach A:</strong> Self-service via portal, immediate access, DIY support<br><strong>Approach B:</strong> IT-assisted, scheduled setup, full support included<br><strong>Popular choice:</strong> New employees prefer Approach B for guidance<br><strong>Experienced employees:</strong> Usually go with Approach A for speed<br><br>Since you've been here a while, Approach A might be faster. Want me to walk you through it?"
                    ]
                },
                // Time/scheduling (When/Schedule/Deadline)
                'time|when|schedule|deadline|date': {
                    patterns: [
                        "Let me check your calendar and relevant deadlines...<br><br><strong>Optimal timing:</strong> Next Tuesday-Wednesday looks best - you have lighter meetings those days<br><strong>Deadline considerations:</strong> End of month closes Friday, so wrapping this up by Thursday gives you buffer<br><strong>Team availability:</strong> The people you need are in the office Wednesday-Thursday<br><br>I recommend starting Tuesday morning. Should I send calendar holds and prep an agenda?",
                        "Looking at your schedule and work patterns:<br><br><strong>Earliest possible:</strong> Tomorrow afternoon (you have a 2-hour window)<br><strong>Ideal timing:</strong> Next Monday when you're typically more focused<br><strong>Latest advisable:</strong> Before the All-Hands on the 15th<br><br>Trade-off: Tomorrow gets it done fast but might feel rushed. Next week allows better preparation.<br><br>What's your preference - speed or quality time?",
                        "I've analyzed your calendar, company events, and team schedules:<br><br><strong>Your availability:</strong> 6 open blocks this week, 10 next week<br><strong>Key stakeholders:</strong> Available for meetings Tuesday-Thursday<br><strong>Company calendar:</strong> All-Hands on Friday, better to avoid that day<br><br>Sweet spot: Wednesday at 10am. Morning meetings get better engagement, and everyone's schedules align. Should I set it up?"
                    ]
                },
                // Jokes/fun (Joke/Funny/Laugh)
                'joke|funny|laugh|fun': {
                    patterns: [
                        "Ha! I appreciate the levity. Here's one for you:<br><br>Why did the employee bring a ladder to the meeting?<br><br>Because they wanted to reach new heights! üìà<br><br>Speaking of heights, I noticed your team exceeded performance goals by 35% last quarter. That's genuinely impressive! Want to see the breakdown or celebrate the win?",
                        "Alright, here you go:<br><br>What do you call it when your calendar has too many meetings?<br><br>A meeting-pocalypse! üìÖüí•<br><br>On a serious note, I noticed you have 8 meetings scheduled tomorrow. Want me to identify which ones could be async or rescheduled to give you more focus time?",
                        "You got it:<br><br>Why did the SharePoint document go to therapy?<br><br>It had too many unresolved conflicts! üìÑüòÖ<br><br>Since we're taking a fun break, I noticed you've been working for 3 hours straight. Research shows productivity peaks with regular breaks. Want me to suggest a good time for coffee?"
                    ]
                },
                // Find/search/locate
                'find|search|locate|where can|looking for': {
                    patterns: [
                        "I can help you find that! Based on what you're looking for, here are the most likely places:<br><br><strong>1. SharePoint site:</strong> Check the [Department Name] team site - most documents like this are stored there<br><br><strong>2. Recent activity:</strong> I see similar files were shared in your Teams channels last week<br><br><strong>3. Company resources:</strong> The employee portal has a dedicated section for this<br><br>Should I open the most relevant location for you, or would you like me to search across all sites?",
                        "Great question - let me search our company resources for that:<br><br>I found 12 potential matches in SharePoint, Teams, and the employee portal. The most relevant ones are:<br><br>‚Ä¢ Policy document (updated last month)<br>‚Ä¢ Training guide (viewed by 500+ employees)<br>‚Ä¢ FAQ page (covers your specific question)<br><br>Which would you like me to open first, or should I send you all three links?",
                        "I'm searching for that now across SharePoint, Teams, and your recent activity...<br><br><strong>Top result:</strong> Found in your department's shared folder, last updated 2 weeks ago<br><br><strong>Related resources:</strong> 3 similar documents that might also be helpful<br><br><strong>Who to ask:</strong> Jennifer from your team is tagged as the owner<br><br>Should I open the main document, or would you like to reach out to Jennifer first?"
                    ]
                }
            };

            // Find matching pattern
            let selectedResponses = null;
            for (const [keywords, data] of Object.entries(demoResponses)) {
                const keywordPattern = new RegExp(keywords, 'i');
                if (keywordPattern.test(lowerQ)) {
                    selectedResponses = data.patterns;
                    break;
                }
            }

            // Generate response
            if (selectedResponses) {
                const response = selectedResponses[Math.floor(Math.random() * selectedResponses.length)];
                // Replace {topic} placeholder with extracted subject
                const topic = userMessage.split(' ').slice(1, 4).join(' ') || 'this topic';
                return response.replace('{topic}', topic);
            }

            // Default intelligent response (workplace-focused)
            return `I understand you're asking about "${userMessage}". Let me think about this in context of your work...<br><br>Based on your role and recent company activity, this seems related to workplace processes or company resources. While I don't have a specific pre-programmed answer, I can definitely help you find what you need.<br><br>Would you like me to:<br>‚Ä¢ Search SharePoint and company documentation<br>‚Ä¢ Connect you with the right person or department<br>‚Ä¢ Check if there's a policy or procedure for this<br>‚Ä¢ Help you draft a message to the appropriate team<br><br>What would be most helpful?`;
        }

        // Call LLM (real or demo)
        async function callLLM(userMessage, conversationHistory = []) {
            // Demo Mode - No API key needed!
            if (LLM_CONFIG.demoMode && !LLM_CONFIG.enabled) {
                console.log('Demo mode: Simulating LLM response');

                // Show enhanced thinking animation
                showAgentThinking([
                    'Connecting to Nova intelligence network...',
                    'Processing your question with advanced reasoning...',
                    'Analyzing context and generating personalized response...',
                    'Finalizing recommendations...'
                ]);

                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1500));

                const demoResponse = callDemoLLM(userMessage);
                const confidence = Math.floor(87 + Math.random() * 8); // 87-95%

                return {
                    text: demoResponse,
                    confidence: confidence,
                    source: 'demo-llm'
                };
            }

            // Real LLM Mode - Requires API key
            if (!LLM_CONFIG.enabled) {
                console.warn('LLM is not enabled. Using fallback response.');
                return null;
            }

            if (LLM_CONFIG.apiKey === 'YOUR_API_KEY_HERE') {
                console.error('Please configure your API key in LLM_CONFIG');
                return null;
            }

            try {
                // Build messages array
                const messages = [
                    { role: 'system', content: NOVA_SYSTEM_PROMPT },
                    ...conversationHistory,
                    { role: 'user', content: userMessage }
                ];

                // Show enhanced thinking animation for LLM calls
                showAgentThinking([
                    'Connecting to Nova intelligence network...',
                    'Processing your question with advanced reasoning...',
                    'Analyzing context and generating personalized response...',
                    'Finalizing recommendations...'
                ]);

                const response = await fetch(LLM_CONFIG.endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${LLM_CONFIG.apiKey}`
                    },
                    body: JSON.stringify({
                        model: LLM_CONFIG.model,
                        messages: messages,
                        temperature: 0.7,
                        max_tokens: 500,
                        stream: false // Set to true for streaming if desired
                    })
                });

                if (!response.ok) {
                    throw new Error(`LLM API error: ${response.status}`);
                }

                const data = await response.json();
                const aiResponse = data.choices[0].message.content;

                // Simulate confidence based on response quality
                const confidence = Math.floor(85 + Math.random() * 10); // 85-95%

                return {
                    text: aiResponse,
                    confidence: confidence,
                    source: 'llm'
                };

            } catch (error) {
                console.error('LLM call failed:', error);
                return null;
            }
        }

        // Conversation history for context (last 6 messages)
        let conversationHistory = [];

        function addToHistory(role, content) {
            conversationHistory.push({ role, content });
            // Keep only last 6 messages (3 exchanges)
            if (conversationHistory.length > 6) {
                conversationHistory = conversationHistory.slice(-6);
            }
        }

        // Enhanced Send Message with Hybrid LLM Integration
        async function sendMessage() {
            const input = document.getElementById('userInput');
            const text = input.value.trim();

            if (text) {
                addUserMessage(text);
                addToHistory('user', text);
                input.value = '';
                input.style.height = 'auto';

                // Show thinking animation
                showAgentThinking([
                    'Understanding your question...',
                    'Analyzing relevant context...',
                    'Preparing personalized response...'
                ]);

                // HYBRID APPROACH - Priority order:
                // 0. Agent follow-up responses (if in active agent conversation)
                // 1. Pre-scripted smart responses (for demo reliability)
                // 2. Multi-agent collaboration (for specialized queries)
                // 3. LLM fallback (for custom/off-script questions)
                // 4. Generic fallback (if LLM fails)

                // Check for agent follow-ups first (if we're in an agent conversation)
                if (currentAgentContext) {
                    const agentFollowUp = getAgentFollowUp(text, currentAgentContext);
                    if (agentFollowUp) {
                        setTimeout(() => {
                            addAIMessage(agentFollowUp.initial, false, agentFollowUp.confidence);
                            addToHistory('assistant', agentFollowUp.initial);
                            setTimeout(() => {
                                addAIMessage(agentFollowUp.detail, false, agentFollowUp.confidence);
                                addToHistory('assistant', agentFollowUp.detail);
                                // Keep context active for additional follow-ups
                            }, 1800);
                        }, 2500);
                        return;
                    }
                }

                // Check for smart responses
                const smartResponse = getSmartResponse(text);
                if (smartResponse) {
                    currentAgentContext = null; // Clear agent context
                    setTimeout(() => {
                        addAIMessage(smartResponse.initial, false, smartResponse.confidence);
                        addToHistory('assistant', smartResponse.initial);
                        setTimeout(() => {
                            addAIMessage(smartResponse.detail, false, smartResponse.confidence);
                            addToHistory('assistant', smartResponse.detail);
                        }, 1800);
                    }, 2500);
                    return;
                }

                // Detect if multi-agent collaboration is needed
                const neededAgent = detectNeededAgents(text);
                if (neededAgent) {
                    setTimeout(() => {
                        inviteAgent(neededAgent, text);
                    }, 2500);
                    return;
                }

                // Try LLM for custom questions (includes Demo Mode!)
                if (LLM_CONFIG.enabled || LLM_CONFIG.demoMode) {
                    try {
                        currentAgentContext = null; // Clear agent context for LLM
                        const llmResponse = await callLLM(text, conversationHistory);

                        if (llmResponse) {
                            setTimeout(() => {
                                addAIMessage(llmResponse.text, false, llmResponse.confidence);
                                addToHistory('assistant', llmResponse.text);
                            }, 3000); // Slightly longer for LLM to feel thoughtful
                            return;
                        }
                    } catch (error) {
                        console.error('LLM error, falling back to generic:', error);
                    }
                }

                // Fallback to generic responses if LLM unavailable
                currentAgentContext = null; // Clear agent context
                setTimeout(() => {
                    const responses = [
                        { text: "I understand what you're looking for. Based on your work patterns and current projects, here's what I recommend...", confidence: 87 },
                        { text: "Great question! I've analyzed your recent activity and team context. Here's what stands out...", confidence: 91 },
                        { text: "I've been tracking this for you across multiple data sources. Let me break down the key insights...", confidence: 89 },
                        { text: "This connects to several ongoing initiatives. Let me help you see the bigger picture...", confidence: 85 }
                    ];
                    const response = responses[Math.floor(Math.random() * responses.length)];
                    addAIMessage(response.text, false, response.confidence);
                    addToHistory('assistant', response.text);
                }, 2500);
            }
        }

        // Agent switcher
        document.querySelectorAll('.agent-option').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.agent-option').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                const agentName = this.textContent.trim().split(' ')[1];
                hideEmptyState();
                addAIMessage(`I've switched to ${agentName} mode. How can I assist you with ${agentName.toLowerCase()} matters?`, false);
            });
        });

        // Predictive Panel - Show after 10 seconds
        setTimeout(() => {
            showPredictivePanel();
        }, 10000);

        // Initialize
        renderInsights();
    </script>
</body>
</html>
